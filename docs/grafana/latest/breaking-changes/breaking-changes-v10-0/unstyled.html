<!DOCTYPE html>
<h1 id="breaking-changes-in-grafana-v100">Breaking changes in Grafana v10.0</h1>
<p>Following are breaking changes that you should be aware of when upgrading to Grafana v10.0.</p>
<p>For our purposes, a breaking change is any change that requires users or operators to do something. This includes:</p>
<ul>
<li>Changes in one part of the system that could cause other components to fail</li>
<li>Deprecations or removal of a feature</li>
<li>Changes to an API that could break automation</li>
<li>Changes that affect some plugins or functions of Grafana</li>
<li>Migrations that can’t be rolled back</li>
</ul>
<p>For each change, the provided information:</p>
<ul>
<li>Helps you determine if you’re affected</li>
<li>Describes the change or relevant background information</li>
<li>Guides you in how to mitigate for the change or migrate</li>
<li>Provides more learning resources</li>
</ul>
<p>For release highlights and deprecations, refer to our <a href="../../whatsnew/whats-new-in-v10-0/">v10.0 What’s new</a>. For the specific steps we recommend when you upgrade to v10.0, check out our <a href="../../upgrade-guide/upgrade-v10.0/">Upgrade guide</a>.</p>
<!--
## Feature

You must use relative references when linking to docs within the Grafana repo. Please do not use absolute URLs. For more information about relrefs, refer to [Links and references](/docs/writers-toolkit/writing-guide/references/).-->
<h2 id="general-breaking-changes">General breaking changes</h2>
<h3 id="angular-is-deprecated-and-turned-off-by-default-for-new-grafana-cloud-stacks">Angular is deprecated and turned off by default for new Grafana Cloud stacks</h3>
<h4 id="you-are-affected-if">You are affected if:</h4>
<p>You create a new Grafana Cloud stack and intend to use any panel or data source plugins written using the Angular.js JavaScript framework. See the <a href="../../developers/angular_deprecation/angular-plugins/">list of Angular plugins</a>.</p>
<h4 id="background">Background</h4>
<p>AngularJS is an old frontend framework that stopped active development many years ago. Because of that, it&rsquo;s a security risk. AngularJS also requires <strong>unsafe-eval</strong> in the <a href="https://developer.mozilla.org/en/Security/CSP" target="_blank" rel="noopener noreferrer">CSP (Content Security Policy)</a> settings, which also reduces the security level of how javascript is executed in the browser.</p>
<p>Angular plugin support in Grafana is deprecated, meaning it will be removed in a future release. There are still some community and private plugins built using Angular. Starting with v9.0, Grafana has a server configuration option, called <a href="../../setup-grafana/configure-grafana/#angular_support_enabled">angular_support_enabled</a>, that controls whether Angular plugin support is available.</p>
<h4 id="change-in-grafana-v10">Change in Grafana v10</h4>
<p>Angular is disabled by default for all new Grafana Cloud stacks. Existing stacks in Grafana Cloud, Grafana Enterprise on-premise instances, and Grafana OSS instances will not be automatically impacted.</p>
<h4 id="how-to-mitigate">How to mitigate</h4>
<p>If you&rsquo;re using Angular plugins in Grafana, try an alternative panel or data source that doesn&rsquo;t use Angular. This list of detected <a href="../../developers/angular_deprecation/angular-plugins/">Angular plugins</a> offers alternatives where they exist.</p>
<p>If you&rsquo;re a developer maintaining a plugin that uses Angular, we recommend you refactor or rewrite its frontend using React.js instead. The team at Grafana is ready to help and provide tools and guidance; you can reach us in <a href="https://grafana.slack.com/archives/C3HJV5PNE" target="_blank" rel="noopener noreferrer">Slack</a> or on our <a href="https://community.grafana.com/c/plugin-development/30" target="_blank" rel="noopener noreferrer">Forum</a>.</p>
<h4 id="learn-more">Learn more</h4>
<ul>
<li><a href="../../developers/angular_deprecation/">Angular Support Deprecation documentation</a></li>
</ul>
<h3 id="grafana-legacy-alerting-is-deprecated-and-no-longer-accepts-internal-or-external-contributions">Grafana legacy alerting is deprecated and no longer accepts internal or external contributions</h3>
<h4 id="you-are-affected-if-1">You are affected if:</h4>
<p>You use Grafana legacy alerting and have requested new features or changes to it.</p>
<h4 id="description">Description</h4>
<p>Grafana legacy alerting (dashboard alerts) has been deprecated since Grafana v9.0, in favor of the new, improved Grafana Alerting. In Grafana v10, the legacy alerting codebase—which depends on Angular—is still available, but we&rsquo;ll no longer contribute to it or accept external contributions for it. We&rsquo;ll continue to work on the migration path from legacy alerting to Grafana Alerting for our remaining users that need to migrate.</p>
<h4 id="migration-path">Migration path</h4>
<p>The new Grafana Alerting was introduced in Grafana 8 and is a superset of legacy alerting. Learn how to migrate your alerts in the <a href="/docs/grafana/v10.4/alerting/set-up/migrating-alerts/">Upgrade Alerting documentation</a>.</p>
<h3 id="api-keys-are-migrating-to-service-accounts">API keys are migrating to service accounts</h3>
<h4 id="you-are-affected-if-2">You are affected if:</h4>
<p>You use Grafana API keys and haven&rsquo;t yet migrated to service accounts</p>
<h4 id="description-1">Description</h4>
<p>In Grafana v8.5, we introduced <a href="/blog/2022/08/24/new-in-grafana-9.1-service-accounts-are-now-ga/">service accounts</a>, which are a superset of API keys that support token rotation and role-based access control (RBAC). They were promoted to general availability (GA) in v9.1, with an option to manually migrate API keys to service accounts through the UI and API since then. <strong>When you upgrade to Grafana v10, Grafana will automatically migrate all API keys to service accounts and hide the API keys screen that was under the Admin section.</strong></p>
<p>This is a &ldquo;breaking&rdquo; change because if users are used to seeing and interacting with API keys, they won&rsquo;t see that page in navigation anymore and will need to navigate to the <strong>Service accounts</strong> page instead. However, your existing API tokens will remain fully functional and migrated to service accounts, so no automation will break. If you roll back to a previous version of Grafana, your API keys will remain intact.</p>
<p>Grafana&rsquo;s <a href="../../developers/http_api/auth/#create-api-token">HTTP API endpoints for generating and managing API Keys</a> remain functional, but we recommend you begin using the <a href="../../developers/http_api/serviceaccount/">Service account HTTP API</a> to generate and manage machine authentication instead.</p>
<h4 id="migration-path-1">Migration path</h4>
<p>While upgrading to Grafana v10, you don&rsquo;t need to take any action; your API keys will be automatically migrated. To test or perform the migration from API keys to service accounts before upgrading to Grafana v10, follow our 
    <a href="/docs/grafana/latest/administration/service-accounts/migrate-api-keys/">migration documentation</a>.</p>
<h4 id="learn-more-1">Learn more</h4>
<ul>
<li>
<p>
    <a href="/docs/grafana/latest/administration/service-accounts/migrate-api-keys/">Documentation on migrating from API keys to service accounts</a></p>
</li>
<li>
<p><a href="/blog/2022/08/24/new-in-grafana-9.1-service-accounts-are-now-ga/">Blog post announcement with a video demo including how to migrate</a></p>
</li>
</ul>
<h3 id="the-experimental-dashboard-previews-feature-is-removed">The experimental &ldquo;dashboard previews&rdquo; feature is removed</h3>
<h4 id="you-are-affected-if-3">You are affected if:</h4>
<p>You have the <code>dashboardPreviews</code> feature toggle switched on.</p>
<h4 id="description-2">Description</h4>
<p>We&rsquo;re removing the experimental dashboard previews feature due to user permission and performance issues that prevented us from continuing its development. Dashboard previews have been behind a feature toggle since Grafana v9.0.</p>
<h4 id="migration-path-2">Migration path</h4>
<p>The entire feature has been removed from Grafana. For users who enabled the <code>dashboardPreviews</code> feature flag, Grafana will continue to work as-is but without dashboard previews. We recommend you remove the <code>dashboardPreviews</code> feature flag from your Grafana configuration.</p>
<h4 id="learn-more-2">Learn more</h4>
<ul>
<li><a href="/docs/grafana/v9.5/search/dashboard-previews/">Previous dashboard previews documentation</a></li>
</ul>
<h3 id="rbac-is-on-by-default-in-grafana-enterprise-and-cannot-be-disabled">RBAC is on by default in Grafana Enterprise and cannot be disabled</h3>
<h4 id="you-are-affected-if-4">You are affected if:</h4>
<p>You have actively disabled RBAC in Grafana&rsquo;s configuration.</p>
<h4 id="description-3">Description</h4>
<p>Starting from Grafana 9, RBAC has been enabled by default. An option to disable RBAC was introduced as an emergency mechanism and has only been used in rare cases. With Grafana v10 we removed the configuration option to disable RBAC. This ensures that Grafana works consistently across different features and decreases the risk of having issues with Grafana&rsquo;s legacy access control. Additionally, access control for some of the Grafana v10 features only work with the RBAC, so disabling it is no longer an option.</p>
<h4 id="migration-path-3">Migration path</h4>
<p>No action is needed—migration is automatic. Users&rsquo; current roles, permissions, SSO mapping, and other authorization functionality will continue to work as before.</p>
<h3 id="usernames-are-now-case-insensitive-by-default">Usernames are now case-insensitive by default</h3>
<h4 id="you-are-affected-if-5">You are affected if:</h4>
<p>You run Grafana with a Postgres or sqlite database, you import users from different SSO identity providers (like Google and Active Directory), and users who signed in from different providers were previously created twice because of case differences (for example &ldquo;<a href="mailto:Myra@Grafana.com">Myra@Grafana.com</a>&rdquo; vs &ldquo;<a href="mailto:myra@grafana.com">myra@grafana.com</a>.&rdquo;</p>
<h4 id="background-1">Background</h4>
<p>When someone signs up for a Grafana account, they can do it using an email or a login. The fields were case sensitive, which could lead to two or more accounts being created for the same user. Additionally, Grafana allows users to set up an authentication provider, and that provider might return an individual&rsquo;s sign-up email with an uppercased domain name or some combination of uppercase and lowercase letters.</p>
<p>Having several accounts leads to split user permissions, confusion among signup flows, and unused &ldquo;zombie&rdquo; accounts in your database. Plus, multiple accounts can introduce issues when switching between authentication providers. We refer to these inconsistencies in user uniqueness as a <em>user identity conflict</em>.</p>
<h4 id="change-in-grafana-v10-1">Change in Grafana v10</h4>
<p>Grafana will start matching users without regard for case. Conflicting users will not be able to sign in.</p>
<h4 id="migration-path-4">Migration path</h4>
<p>We&rsquo;ve built a <a href="/blog/2022/12/12/guide-to-using-the-new-grafana-cli-user-identity-conflict-tool-in-grafana-9.3/">CLI tool</a> which users can use to resolve any potential conflicts beforehand. This breaking change was communicated already with Grafana v9.3.</p>
<h4 id="learn-more-3">Learn more</h4>
<ul>
<li><a href="/blog/2022/12/12/guide-to-using-the-new-grafana-cli-user-identity-conflict-tool-in-grafana-9.3/">Blog post describing usage of the new CLI command</a></li>
</ul>
<h3 id="grafana-oauth-integrations-do-not-work-anymore-with-email-lookups">Grafana OAuth integrations do not work anymore with email lookups</h3>
<h4 id="you-are-affected-if-6">You are affected if:</h4>
<ul>
<li>You have configured Grafana to use multiple identity providers, and you have users with the same email address in multiple identity providers.</li>
<li>You have configured Grafana to use Generic OAuth with an identity provider that does not support a unique ID field.</li>
</ul>
<h4 id="background-2">Background</h4>
<p>Grafana used to validate identity provider accounts based on the email claim. On many identity providers, the email field is not unique, and this could open a possible account vector to perform an account takeover and authentication bypass in certain scenarios.
This change also ensures that Grafana is protected against the <a href="/security/security-advisories/cve-2023-3128/">CVE-2023-3128</a> vulnerability.</p>
<h4 id="change-in-grafana-v10-2">Change in Grafana v10</h4>
<p>Grafana will not allow the affected users to sign in.</p>
<h4 id="migration-path-5">Migration path</h4>
<p>In order to address any errors, we have provided an escape hatch that allows you to activate email lookup. You can use the following configuration in your Grafana instance to return the previous behavior.</p>
<pre>[auth]
oauth_allow_insecure_email_lookup = true</pre>
<p>We strongly recommend not doing this in case you are using Azure AD as an identity provider with a multi-tenant app.</p>
<h4 id="learn-more-4">Learn more</h4>
<ul>
<li><a href="/security/security-advisories/cve-2023-3128//">CVE-2023-3128 Advisory</a></li>
<li><a href="../../setup-grafana/configure-security/configure-authentication/">Enable email lookup</a></li>
</ul>
<h3 id="the-alias-field-in-the-cloudwatch-data-source-is-removed">The &ldquo;Alias&rdquo; field in the CloudWatch data source is removed</h3>
<h4 id="you-are-affected-if-7">You are affected if:</h4>
<p>You&rsquo;re using the &ldquo;Alias&rdquo; field in the CloudWatch data source, instead of using dynamic labels.</p>
<h4 id="description-4">Description</h4>
<p>Alias patterns in the CloudWatch query editor were replaced by Label (dynamic labels) behind a feature toggle. Starting from Grafana v9, Label has been enabled by default. With Grafana v10 we removed the option to disable Label and remove the Alias field entirely.</p>
<h4 id="migration-path-6">Migration path</h4>
<p>Open and save each dashboard that uses the Alias field. Alias is migrated to Label automatically when you load the dashboard.</p>
<h4 id="learn-more-5">Learn more</h4>
<ul>
<li><a href="../../datasources/aws-cloudwatch/query-editor/#label">Grafana CloudWatch documentation about the change</a></li>
</ul>
<h3 id="athena-data-source-plugin-must-be-updated-to-version-293">Athena data source plugin must be updated to version &gt;=2.9.3</h3>
<h4 id="you-are-affected-if-8">You are affected if:</h4>
<p>You&rsquo;ve installed and are using the Athena data source plugin.</p>
<h4 id="description-5">Description</h4>
<p>Grafana v10.0.0 ships with the new React 18 upgrade. In turn, changes in the batching of state updates in React 18 cause a bug in the query editor in Athena plugin versions &lt;=2.9.2.</p>
<h4 id="migration-path-7">Migration path</h4>
<p>Update the plugin to version 2.9.3 or higher in your Grafana instance management console. This will ensure your plugin query editor works as intended.</p>
<h3 id="redshift-data-source-plugin-must-be-updated-to-version-183">Redshift data source plugin must be updated to version &gt;=1.8.3</h3>
<h4 id="you-are-affected-if-9">You are affected if:</h4>
<p>You&rsquo;ve installed and are using the Redshift data source plugin.</p>
<h4 id="description-6">Description</h4>
<p>Grafana v10.0.0 ships with the new React 18 upgrade. In turn, changes in the batching of state updates in React 18 cause a bug in the query editor in Redshift plugin versions &lt;=1.8.3.</p>
<h4 id="migration-path-8">Migration path</h4>
<p>Update the plugin to version 1.8.3 or higher in your Grafana instance management console. This will ensure your plugin query editor works as intended.</p>
<h3 id="doit-international-bigquery-plugin-no-longer-supported">DoiT International BigQuery plugin no longer supported</h3>
<h4 id="you-are-affected-if-10">You are affected if:</h4>
<p>You&rsquo;ve installed and are using the <a href="https://github.com/doitintl/bigquery-grafana" target="_blank" rel="noopener noreferrer">DoiT International BigQuery data source plugin</a>.</p>
<h4 id="description-7">Description</h4>
<p>In v10.0.0, Grafana no longer supports the use of the <a href="https://github.com/doitintl/bigquery-grafana" target="_blank" rel="noopener noreferrer">DoiT International BigQuery data source plugin</a>, which was moved to a &ldquo;retired&rdquo; state in the latter half of 2022, and for which the GitHub repository was archived in December 2022. For BigQuery data sources to continue functioning, you&rsquo;re required to migrate to the <a href="https://github.com/grafana/google-bigquery-datasource/" target="_blank" rel="noopener noreferrer">Official Grafana BigQuery data source plugin</a>.</p>
<h4 id="migration-path-9">Migration path</h4>
<p>For everyone using Grafana v8.5+, it’s possible to import queries created with the DoiT International BigQuery community plugin by simply changing the data source to Grafana BigQuery in the data source selector in the affected panel. Please note that <a href="https://github.com/grafana/google-bigquery-datasource#importing-queries-created-with-doit-international-bigquery-datasource-plugin" target="_blank" rel="noopener noreferrer">queries will be imported</a> as raw SQL queries.</p>
<h4 id="learn-more-6">Learn more</h4>
<ul>
<li><a href="https://github.com/grafana/google-bigquery-datasource#importing-queries-created-with-doit-international-bigquery-datasource-plugin" target="_blank" rel="noopener noreferrer">Information about importing DoiT International BigQuery queries</a>.</li>
</ul>
<h2 id="for-plugin-developers">For Plugin Developers</h2>
<h3 id="upgrading-to-react-18">Upgrading to React 18</h3>
<h4 id="you-are-affected-if-11">You are affected if:</h4>
<p>You&rsquo;ve developed a Grafana plugin that uses the React JS framework (this includes most app, panel, and data source plugins).</p>
<h4 id="description-8">Description</h4>
<p>Grafana has been upgraded to React 18 and now leverages the new React client rendering API. Plugin authors in particular should be aware, as there could be unintended side effects due to the changes around automatic batching of state updates and consistent <code>useEffect</code> timings.</p>
<h4 id="migration-path-10">Migration path</h4>
<p>As a plugin developer: once a canary build has been released (post-9.5.0), test your plugin against one of the grafana-dev docker builds <a href="https://hub.docker.com/r/grafana/grafana-dev/tags?page=1" target="_blank" rel="noopener noreferrer">here</a> (<a href="https://hub.docker.com/layers/grafana/grafana-dev/10.0.0-111404pre/images/sha256-ac78acf54b44bd2ce7e68b796b1df47030da7f35e53b02bc3eec3f4de05f780f?context=explore" target="_blank" rel="noopener noreferrer">this one</a> for example). Because of the extra optimisations made by React 18, some changes may be needed to maintain previous behavior.</p>
<h4 id="learn-more-7">Learn more</h4>
<ul>
<li>
<p><a href="https://react.dev/blog/2022/03/29/react-v18" target="_blank" rel="noopener noreferrer">React 18 release notes</a></p>
</li>
<li>
<p><a href="https://react.dev/blog/2022/03/08/react-18-upgrade-guide" target="_blank" rel="noopener noreferrer">React 18 upgrade guide</a></p>
</li>
</ul>
<h3 id="deprecated-logs-related-functions-and-variables-have-been-removed-from-the-grafanadata-and-grafanaui-packages">Deprecated logs-related functions and variables have been removed from the &ldquo;@grafana/data&rdquo; and &ldquo;@grafana/ui&rdquo; packages</h3>
<h4 id="you-are-affected-if-12">You are affected if:</h4>
<p>You&rsquo;re a plugin author and you use one of the following logs-related functions:</p>
<ul>
<li>
<p>The interface type LogsParser in grafana-data</p>
</li>
<li>
<p>The following functions and classes related to logs in the grafana-ui package: <code>1LogLabels</code>, <code>LogMessageAnsi</code>, <code>LogRows</code>, <code>getLogRowStyles.</code>, <code>getLogLevel</code>, <code>getLogLevelFromKey</code>, <code>addLogLevelToSeries</code>, <code>LogsParsers</code>, <code>calculateFieldStats</code>, <code>calculateLogsLabelStats</code>, <code>calculateStats</code>, <code>getParser</code>, <code>sortInAscendingOrder</code>, <code>sortInDescendingOrder</code>, <code>sortLogsResult</code>, <code>sortLogRows</code>, <code>checkLogsError</code>, <code>escapeUnescapedString</code>.</p>
</li>
</ul>
<h4 id="description-9">Description</h4>
<p>Certain rarely-used logs-related functions and variables have been moved from grafana-packages to the core grafana codebase. These items have been marked as deprecated previously, and a deprecation-notice was issued in the grafana changelog. Plugin authors who have relied on these functions and variables being available will have to adjust their codebase.</p>
<h4 id="migration-path-11">Migration path</h4>
<p>If you&rsquo;ve written a data source or panel plugin, make sure it doesn&rsquo;t use the functions and variables that have been deprecated and removed.</p>
<h4 id="learn-more-8">Learn more</h4>
<ul>
<li>
<p><a href="https://github.com/grafana/grafana/issues/65779" target="_blank" rel="noopener noreferrer">https://github.com/grafana/grafana/issues/65779</a></p>
</li>
<li>
<p><a href="https://github.com/grafana/grafana/issues/65778" target="_blank" rel="noopener noreferrer">https://github.com/grafana/grafana/issues/65778</a></p>
</li>
</ul>
<h3 id="dataframe-use-array-or-vector-for-field-values">DataFrame: Use Array<T> or Vector<T> for field values</h3>
<!--check on how the <T> are supposed to show up -->
<h4 id="you-are-affected-if-13">You are affected if:</h4>
<p>You&rsquo;re a plugin author and you&rsquo;ve implemented your own version of Vector for data frames.</p>
<h4 id="description-10">Description</h4>
<p>Working with DataFrames was more complicated than it should have been because data was held in a Vector interface rather than a simple Array. In Grafana v10, the interface has been changed so developers can use simple arrays or Vectors.</p>
<h4 id="migration-path-12">Migration path</h4>
<p>Any code using Vectors will continue to work without issue. If you&rsquo;ve implemented your own version of Vector, it will need to be updated. The easiest approach is to refactor code so it extends MutableVector. This will work in both Grafana v9 and v10.</p>
<h4 id="learn-more-9">Learn more</h4>
<ul>
<li><a href="https://github.com/grafana/grafana/issues/66480" target="_blank" rel="noopener noreferrer">https://github.com/grafana/grafana/issues/66480</a></li>
</ul>
<h3 id="grafanatoolkit-cli-commands-have-been-removed-and-migrated-to-the-create-plugin-package">grafana/toolkit CLI commands have been removed and migrated to the create-plugin package</h3>
<h4 id="you-are-affected-if-14">You are affected if:</h4>
<p>You develop plugins using @grafana/toolkit CLI commands.</p>
<h4 id="description-11">Description</h4>
<p>We announced the deprecation of the grafana/toolkit in v9.3 (November 2022) and have a new tool called create-plugin now available as a replacement. We encourage you to migrate and use our updated tooling. All grafana/toolkit commands except <code>build</code> are removed in Grafana v10.</p>
<p>Here are some of the benefits of create-plugin:</p>
<ul>
<li>
<p><strong>More flexible:</strong> With @grafana/create-plugin, you have more control over your plugins and their dependencies, and can more easily customize the tooling to fit your specific needs.</p>
</li>
<li>
<p><strong>Faster development time:</strong> With its out-of-the-box development environment @grafana/create-plugin can significantly reduce development time compared to using @grafana/toolkit.</p>
</li>
<li>
<p><strong>Improved testing capabilities:</strong> Testing plugins with @grafana/create-plugin is much easier with GitHub workflows that automate unit and e2e test runs whenever changes are pushed to GitHub.</p>
</li>
<li>
<p><strong>Better documentation:</strong> The <a href="/developers/plugin-tools/">documentation</a> for @grafana/create-plugin is more comprehensive and easier to discover than that of @grafana/toolkit.</p>
</li>
</ul>
<h4 id="migration-path-13">Migration path</h4>
<p>You may already be using the new tooling. If you have an existing plugin previously created using the @grafana/toolkit, you can use the following command to migrate it to the new build tooling:</p>
<pre>
# Run this command from the root of your plugin

cd ./my-plugin

npx @grafana/create-plugin@latest migrate</pre>
<h4 id="learn-more-10">Learn more</h4>
<ul>
<li><a href="/developers/plugin-tools/migration-guides/migrate-from-toolkit">Migration guide</a></li>
</ul>
<h2 id="deprecations">Deprecations</h2>
<p>Changing the folder UID through the API is deprecated. This functionality will be removed in a future release.</p>
