<!DOCTYPE html>
<h1 id="graphite-query-editor">Graphite query editor</h1>
<p>Grafana includes a Graphite-specific query editor to help you build queries.
The query editor helps you quickly navigate the metric space, add functions, and change function parameters.
It supports a variety of Graphite queries, including complex nested queries, through the use of query references.</p>
<p>For general documentation on querying data sources in Grafana, see 
    <a href="/docs/grafana/latest/panels-visualizations/query-transform-data/">Query and transform data</a>.</p>
<h2 id="query-editor-elements">Query editor elements</h2>
<p>The query editor consists of the following elements:</p>
<ul>
<li>
<p><strong>Series</strong> - A series in Graphite is a unique time-series dataset, represented by a specific metric name and timestamped values. Click <strong>select metric</strong> to select a metric from the drop-down.</p>
</li>
<li>
<p><strong>Functions</strong> - Graphite uses functions to manipulate data. Click the <strong>+ sign</strong> to view a list of functions in the drop-down. You can create a query with multiple functions.</p>
</li>
</ul>
<p>To view the raw query, click the <strong>Pencil icon</strong> in the upper right. Click the <strong>Pencil icon</strong> again to continue adding series and functions.</p>
<h2 id="choose-metrics-to-query">Choose metrics to query</h2>
<p>Click <strong>Select metric</strong> to browse the available metrics. You can navigate using your mouse or arrow keys. You can also select a wildcard.</p>
<div class="screenshot" style="max-width:">
  <a href="/static/img/docs/graphite/graphite-query-editor.gif" title="">
    <img alt="" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
         data-src="/static/img/docs/graphite/graphite-query-editor-still.png" class="screenshot__still lazyload">
    <img alt="" src="/static/img/docs/graphite/graphite-query-editor.gif" class="screenshot__animated-gif">
    <div class="screenshot__play">
      <i class="fa fa-play"></i>
    </div></a>
</div>
<h2 id="functions">Functions</h2>
<p>Click the <strong>+ sign</strong> next to <strong>Function</strong> to add a function from the drop-down. You can also search by typing the first few letters of the function name.</p>
<p>After selecting a function, Grafana adds it to your query and automatically places your cursor in the first parameter field.</p>
<p>To edit a parameter, click it to open an editable text box.</p>
<p>To remove a function simply click on it, then click the <strong>X icon</strong> that appears above it.</p>
<div class="screenshot" style="max-width:">
  <a href="/static/img/docs/graphite/graphite-functions-demo.gif" title="">
    <img alt="" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
         data-src="/static/img/docs/graphite/graphite-functions-still.png" class="screenshot__still lazyload">
    <img alt="" src="/static/img/docs/graphite/graphite-functions-demo.gif" class="screenshot__animated-gif">
    <div class="screenshot__play">
      <i class="fa fa-play"></i>
    </div></a>
</div>
<p>Some functions like <code>aliasByNode</code> support an optional second argument. To add this argument, hover your mouse over the argument and a dialog box appears. To remove the second optional parameter, click on it to delete it.</p>
<p>Refer to <a href="https://graphite.readthedocs.io/en/latest/functions.html" target="_blank" rel="noopener noreferrer">Functions</a> in the Graphite documentation for more information.</p>


<div class="admonition admonition-warning"><blockquote><p class="title text-uppercase">Warning</p><p>Some functions accept a second argument, which can itself be another function that returns a series. If you need to add a second argument that is a function, Grafana recommends using a series reference from a second query instead of embedding the function directly.</p>
<p>Currently, the query editor does not support parsing a second function argument when switching between the query builder and the code editor.</p></blockquote></div>

<h3 id="sort-labels">Sort labels</h3>
<p>If the same labels appear on multiple graphs, they may be sorted differently and assigned different colors.</p>
<p>To ensure consistent sorting and coloring, use the <code>sortByName()</code> function to order labels alphabetically.</p>
<h3 id="modify-the-metric-name-in-my-tables-or-charts">Modify the metric name in my tables or charts</h3>
<p>Use <code>alias</code> functions, such as <code>aliasByNode()</code> or <code>aliasSub()</code>, to change metric names on Grafana tables or graphs.</p>
<h3 id="consolidate-data-points">Consolidate data points</h3>
<p>Grafana consolidates all Graphite metrics so that Graphite doesn&rsquo;t return more data points than there are pixels in the graph.
By default, Grafana consolidates data points using the <code>avg</code> function.
To control how Graphite consolidates metrics, use the Graphite <code>consolidateBy()</code> function.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Grafana calculates legend summary values like <code>max</code>, <code>min</code>, and <code>total</code> on the client side, after data has been calculated.
Depending on the consolidation function used, only one or two of these values may be accurate at the same time.</p></blockquote></div>

<h3 id="combine-time-series">Combine time series</h3>
<p>To combine time series, click <strong>Combine</strong> in the <strong>Functions</strong> list.</p>
<h3 id="select-and-explore-data-with-tags">Select and explore data with tags</h3>
<p>In Graphite, everything is a tag.</p>
<p>When exploring data, previously selected tags filter the remaining result set.
To select data, use the <code>seriesByTag</code> function, which takes tag expressions (<code>=</code>, <code>!=</code>, <code>=~</code>, <code>!=~</code>) to filter timeseries.</p>
<p>The Grafana query builder does this for you automatically when you select a tag.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Regular expression searches can be slow on high-cardinality tags, so try to use other tags to reduce the scope first. To help reduce the results, start by filtering on a particular name or namespace.</p></blockquote></div>

<h2 id="nested-queries">Nested queries</h2>
<p>Grafana lets you reference one query from another using its query letter, similar to how cell references work in a spreadsheet.</p>
<p>For example, if you add a second query and want to build on the results of query A, you can reference it using #A.</p>
<p>This approach allows you to build compound or nested queries, making your panels more flexible and easier to manage.</p>
<h2 id="use-wildcards-to-make-fewer-queries">Use wildcards to make fewer queries</h2>
<p>To display multiple time series on the same graph, use wildcards in your query to return all matching series at once.</p>
<p>For example, to monitor CPU utilization across a variety of metrics, you can use a single query like <code>cpu.percent.*.g</code> to retrieve all matching time series.
This approach is more efficient than writing separate queries for each series, such as <code>cpu.percent.user.g</code>, <code>cpu.percent.system.g</code>, and others, which would result in multiple queries to the data source.</p>
<h2 id="apply-annotations">Apply annotations</h2>
<p>
    <a href="/docs/grafana/latest/dashboards/build-dashboards/annotate-visualizations/">Annotations</a> overlay rich event information on top of graphs. You can add annotation queries in the dashboard menu&rsquo;s <strong>Annotations</strong> view.</p>
<p>Graphite supports two ways to query annotations:</p>
<ul>
<li>A regular metric query, using the <code>Graphite query</code> textbox.</li>
<li>A Graphite events query, using the <code>Graphite event tags</code> textbox with a tag, wildcard, or empty value</li>
</ul>
<h2 id="integration-with-loki">Integration with Loki</h2>
<p>When you change the data source to Loki in Explore, your Graphite queries are automatically converted to Loki queries. Loki label names and values are extracted based on the mapping information defined in your Graphite data source configuration. Grafana automatically transforms queries that use tags with <code>seriesByTags()</code> without requiring additional setup.</p>
