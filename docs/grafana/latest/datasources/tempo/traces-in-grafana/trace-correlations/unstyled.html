<!DOCTYPE html>
<h1 id="trace-correlations">Trace correlations</h1>
<p>You can use Grafana 
    <a href="/docs/grafana/latest/administration/correlations/">correlations</a> to embed interactive correlation links in your trace view to jump from spans to related logs, metrics, profiles, or external systems. This guide explains how to configure and manage Trace correlations in Grafana.</p>
<h2 id="what-are-trace-correlations">What are trace correlations?</h2>
<p>Trace correlations let you define rules that inject context-sensitive links into your trace spans. When viewing traces in Explore or the Traces panel, users can click these links to navigate directly to relevant queries or URLs. Correlations are similar but more flexible to the 
    <a href="/docs/grafana/latest/datasources/tempo/configure-tempo-data-source/">trace to logs, metrics, and profiles links you can configure for the Tempo data source</a>.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
    style="max-width: 900px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/media/docs/tempo/screenshot-trace-view-correlations.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/media/docs/tempo/screenshot-trace-view-correlations.png"data-srcset="/media/docs/tempo/screenshot-trace-view-correlations.png?w=320 320w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=550 550w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=750 750w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=900 900w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=1040 1040w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=1240 1240w, /media/docs/tempo/screenshot-trace-view-correlations.png?w=1920 1920w"
          data-sizes="auto"alt="Using correlations for a trace"width="1400"height="1170"/>
        <noscript>
          <img
            src="/media/docs/tempo/screenshot-trace-view-correlations.png"
            alt="Using correlations for a trace"width="1400"height="1170"class="docs-image--no-shadow"/>
        </noscript></div></a></figure>
<h2 id="before-you-begin">Before you begin</h2>
<p>To use trace correlations, you need:</p>
<ul>
<li>Grafana 12 or later</li>
<li>A 
    <a href="/docs/grafana/latest/datasources/tempo/configure-tempo-data-source/">Tempo data source</a> configured in Grafana</li>
<li>Admin access to configuration settings or provisioning files in Grafana</li>
</ul>
<h2 id="set-up-a-trace-correlation">Set up a trace correlation</h2>
<ol>
<li>
<p>Log in to Grafana with an admin account.</p>
</li>
<li>
<p>Go to <strong>Configuration</strong> &gt; <strong>Plugins &amp; data</strong> &gt; <strong>Correlations</strong>.</p>
</li>
<li>
<p>Select <strong>Add correlation</strong> or <strong>Add new</strong>.</p>
</li>
<li>
<p>On step 1, provide a <strong>label</strong> for the correlation, and an optional <strong>description</strong>.</p>
</li>
<li>
<p>On step 2, configure the correlation <strong>target</strong>.</p>
<ul>
<li>
<p>Select the <strong>Type</strong> drop-down list and choose <strong>Query</strong> to link to another data source or choose <strong>External</strong> for a custom URL.</p>
</li>
<li>
<p>For a query <strong>Target</strong>, select the target drop-down list and select the data source that should be queried when the link is clicked. Define the target query.</p>
</li>
<li>
<p>For an external <strong>Target</strong>, enter the <strong>External URL</strong>.</p>
</li>
<li>
<p>For both query and external targets, you can use the following variables based on trace data. Object variables must be parsed into a value variable with a regular expression transformation.</p>
</li>
</ul>
<table>
  <thead>
      <tr>
          <th>Variable</th>
          <th>Type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>traceId</code></td>
          <td>String</td>
          <td>Trace identifier</td>
      </tr>
      <tr>
          <td><code>spanID</code></td>
          <td>String</td>
          <td>Span identifier</td>
      </tr>
      <tr>
          <td><code>parentSpanID</code></td>
          <td>String</td>
          <td>Parent span identifier</td>
      </tr>
      <tr>
          <td><code>serviceName</code></td>
          <td>String</td>
          <td>Service name</td>
      </tr>
      <tr>
          <td><code>serviceTags</code></td>
          <td>Object</td>
          <td>Resource attributes</td>
      </tr>
      <tr>
          <td><code>tags</code></td>
          <td>Object</td>
          <td>Span attributes</td>
      </tr>
      <tr>
          <td><code>logs</code></td>
          <td>Object</td>
          <td>Trace events</td>
      </tr>
      <tr>
          <td><code>references</code></td>
          <td>Object</td>
          <td>Trace links</td>
      </tr>
  </tbody>
</table>
<figure
       class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
       style="max-width: 900px;"
       itemprop="associatedMedia"
       itemscope=""
       itemtype="http://schema.org/ImageObject"
     ><a
           class="lightbox-link"
           href="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png"
           itemprop="contentUrl"
         ><div class="img-wrapper w-100p h-auto"><img
             class="lazyload "
             data-src="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png?w=1920 1920w"
             data-sizes="auto"alt="Setting up a correlation for a Loki target using trace variables"width="1824"height="1226"/>
           <noscript>
             <img
               src="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-2.png"
               alt="Setting up a correlation for a Loki target using trace variables"width="1824"height="1226"class="docs-image--no-shadow"/>
           </noscript></div></a></figure>
</li>
<li>
<p>On step 3, configure the correlation data source:</p>
<ul>
<li>
<p>Select your Tempo data source in the <strong>Source</strong> drop-down list.</p>
</li>
<li>
<p>Enter the trace data variable you use for the correlation in the <strong>Results field</strong>.</p>
</li>
<li>
<p>Optionally, add one or more <strong>Transformations</strong> to parse the trace data into additional variables. You can use these variables to configure the correlation <strong>Target</strong>.</p>
</li>
</ul>
<figure
       class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
       style="max-width: 900px;"
       itemprop="associatedMedia"
       itemscope=""
       itemtype="http://schema.org/ImageObject"
     ><a
           class="lightbox-link"
           href="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png"
           itemprop="contentUrl"
         ><div class="img-wrapper w-100p h-auto"><img
             class="lazyload "
             data-src="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png?w=1920 1920w"
             data-sizes="auto"alt="Setting up a correlation for a Loki data source"width="1826"height="1060"/>
           <noscript>
             <img
               src="/media/docs/tempo/screenshot-grafana-trace-correlations-loki-step-3.png"
               alt="Setting up a correlation for a Loki data source"width="1826"height="1060"class="docs-image--no-shadow"/>
           </noscript></div></a></figure>
</li>
<li>
<p>Select <strong>Save</strong> to save the correlation.</p>
</li>
</ol>
<h2 id="verifying-correlations-in-explore">Verifying correlations in Explore</h2>
<ol>
<li>
<p>Open <strong>Explore</strong> and select your Tempo tracing source.</p>
</li>
<li>
<p>Run a query to load spans.</p>
</li>
<li>
<p>Hover over the span links menu or open the span details to reveal the correlation link buttons.</p>
<figure
       class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
       style="max-width: 900px;"
       itemprop="associatedMedia"
       itemscope=""
       itemtype="http://schema.org/ImageObject"
     ><a
           class="lightbox-link"
           href="/media/docs/tempo/screenshot-grafana-trace-view-correlations.png"
           itemprop="contentUrl"
         ><div class="img-wrapper w-100p h-auto"><img
             class="lazyload "
             data-src="/media/docs/tempo/screenshot-grafana-trace-view-correlations.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-view-correlations.png?w=1920 1920w"
             data-sizes="auto"alt="Using correlations for a trace"width="1400"height="1170"/>
           <noscript>
             <img
               src="/media/docs/tempo/screenshot-grafana-trace-view-correlations.png"
               alt="Using correlations for a trace"width="1400"height="1170"class="docs-image--no-shadow"/>
           </noscript></div></a></figure>
</li>
<li>
<p>Click a correlation link to open a split view or navigate to your target system or query.</p>
</li>
</ol>
<h2 id="examples">Examples</h2>
<p>Below are several practical correlation configurations to get you started.</p>
<h3 id="example-1-trace-to-logs-by-service-name-and-trace-identifier">Example 1: Trace to logs by service name and trace identifier</h3>
<p>In this example, you configure trace to logs by service name and a trace identifier.</p>
<ol>
<li>
<p>On step 1, add a new correlation with the label <strong>Logs for this service and trace</strong> and an optional description.</p>
<figure
       class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
       style="max-width: 900px;"
       itemprop="associatedMedia"
       itemscope=""
       itemtype="http://schema.org/ImageObject"
     ><a
           class="lightbox-link"
           href="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png"
           itemprop="contentUrl"
         ><div class="img-wrapper w-100p h-auto"><img
             class="lazyload "
             data-src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png?w=1920 1920w"
             data-sizes="auto"alt="Using correlations for a trace"width="1812"height="562"/>
           <noscript>
             <img
               src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-1.png"
               alt="Using correlations for a trace"width="1812"height="562"class="docs-image--no-shadow"/>
           </noscript></div></a></figure>
</li>
<li>
<p>On step 2, configure the correlation target:</p>
<ul>
<li>
<p>Select the target type <strong>Query</strong> and select your Loki data source as <strong>Target</strong>.</p>
</li>
<li>
<p>Define the Loki query, using <code>serviceName</code> and <code>traceID</code> as variables derived from the span data:</p>
<pre>{service_name=&#34;$serviceName&#34;} | trace_id=`$traceID` |= ``</pre>
<figure
         class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
         style="max-width: 900px;"
         itemprop="associatedMedia"
         itemscope=""
         itemtype="http://schema.org/ImageObject"
       ><a
             class="lightbox-link"
             href="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png"
             itemprop="contentUrl"
           ><div class="img-wrapper w-100p h-auto"><img
               class="lazyload "
               data-src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png?w=1920 1920w"
               data-sizes="auto"alt="Using correlations for a trace"width="1816"height="1370"/>
             <noscript>
               <img
                 src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-2.png"
                 alt="Using correlations for a trace"width="1816"height="1370"class="docs-image--no-shadow"/>
             </noscript></div></a></figure>
</li>
</ul>
</li>
<li>
<p>On step 3, configure the correlation source:</p>
<ul>
<li>
<p>Select your Tempo data source as <strong>Source</strong>.</p>
</li>
<li>
<p>Use <code>traceID</code> as <strong>Results field</strong>.</p>
</li>
<li>
<p>Add a new transformation to extract the <code>serviceName</code> from the span <code>serviceTags</code> using the regular expression:</p>
<pre>{(?=[^\}]*\bkey&#34;:&#34;service.name&#34;)[^\}]*\bvalue&#34;:&#34;(.*?)&#34;.*}</pre>
</li>
</ul>
<figure
       class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--no-shadow"
       style="max-width: 900px;"
       itemprop="associatedMedia"
       itemscope=""
       itemtype="http://schema.org/ImageObject"
     ><a
           class="lightbox-link"
           href="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png"
           itemprop="contentUrl"
         ><div class="img-wrapper w-100p h-auto"><img
             class="lazyload "
             data-src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png"data-srcset="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=320 320w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=550 550w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=750 750w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=900 900w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=1040 1040w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=1240 1240w, /media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png?w=1920 1920w"
             data-sizes="auto"alt="Using correlations for a trace"width="1812"height="1050"/>
           <noscript>
             <img
               src="/media/docs/tempo/screenshot-grafana-trace-view-correlations-example-1-step-3.png"
               alt="Using correlations for a trace"width="1812"height="1050"class="docs-image--no-shadow"/>
           </noscript></div></a></figure>
</li>
<li>
<p>Save the correlation.</p>
</li>
</ol>
<h3 id="example-2-trace-to-custom-url">Example 2: Trace to custom URL</h3>
<p>In this example, you configure trace corrections with a custom URL.</p>
<ol>
<li>
<p>On step 1, add a new correlation with the label <strong>Open custom URL</strong> and an optional description.</p>
</li>
<li>
<p>On step 2, configure the correlation target:</p>
<ul>
<li>
<p>Select the target type <strong>External</strong>.</p>
</li>
<li>
<p>Define your target URL, using variables derived from the span data. In this example, we are using <code>serviceName</code> and <code>traceID</code>.</p>
<pre>https://my-server.example.com/service=$serviceName&amp;trace=$traceID</pre>
</li>
</ul>
</li>
<li>
<p>On step 3, configure the correlation source:</p>
<ul>
<li>
<p>Select your Tempo data source as <strong>Source</strong>.</p>
</li>
<li>
<p>Use <code>traceID</code> as <strong>Results field</strong>.</p>
</li>
<li>
<p>Add a new transformation to extract the <code>serviceName</code> from the span <code>serviceTags</code> using the regular expression:</p>
<pre>{(?=[^\}]*\bkey&#34;:&#34;service.name&#34;)[^\}]*\bvalue&#34;:&#34;(.*?)&#34;.*}</pre>
</li>
</ul>
</li>
<li>
<p>Save the correlation.</p>
</li>
</ol>
<h2 id="best-practices">Best practices</h2>
<ul>
<li>
<p><strong>Name clearly:</strong> Use descriptive names indicating source and target. For example: <strong>Trace to errors in logs</strong>.</p>
</li>
<li>
<p><strong>Limit scope</strong>: For high-cardinality fields (like <code>traceID</code>), ensure your target system can handle frequent queries.</p>
</li>
<li>
<p><strong>Template wisely:</strong> Use multiple <code>$variable</code> tokens if you need to inject more than one field.</p>
</li>
</ul>
