<!DOCTYPE html>
<h1 id="use-traces-in-grafana">Use traces in Grafana</h1>
<p>Using traces, you can search for traces, generate metrics from spans, and link your tracing data with logs, metrics, and profiles.</p>
<p>This page provides a summary of how you can use tracing data in Grafana.</p>
<p>For general documentation on querying data sources in Grafana, refer to <a href="/docs/grafana-cloud/visualizations/panels-visualizations/query-transform-data/">Query and transform data</a>.</p>


<div data-shared="tempo-in-grafana.md">
            <!--  Use traces in Grafana -->
<h2 id="query-your-data">Query your data</h2>
<p>Using tracing data in Grafana and Grafana Cloud Traces, you can search for traces, generate metrics from spans, and link your tracing data with logs, metrics, and profiles.</p>
<h3 id="use-traces-drilldown-to-investigate-tracing-data">Use Traces Drilldown to investigate tracing data</h3>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Traces Drilldown is currently in <a href="/docs/release-life-cycle/">public preview</a>. Grafana Labs offers limited support, and breaking changes might occur prior to the feature being made generally available.</p></blockquote></div>


<p><a href="/docs/grafana-cloud/visualizations/simplified-exploration/traces/">Grafana Traces Drilldown</a> helps you visualize insights from your Tempo traces data.
Using the app, you can:</p>
<ul>
<li>Use <em>Rate</em>, <em>Errors</em>, and <em>Duration</em> (RED) metrics derived from traces to investigate issues</li>
<li>Uncover related issues and monitor changes over time</li>
<li>Browse automatic visualizations of your data based on its characteristics</li>
<li>Do all of this without writing TraceQL queries</li>
</ul>
<p>Expand your observability journey and learn about <a href="/docs/grafana-cloud/visualizations/simplified-exploration/">the Drilldown apps suite</a>.</p>


  <div
    class="youtube-lazyload responsive-video"
    data-embed="a3uB1C2oHA4"
    data-url="https://www.youtube.com/embed/a3uB1C2oHA4?autoplay=1"
    data-title="YouTube Video"
  >
    <div class="play-button"></div>
  </div>
<h3 id="search-for-traces">Search for traces</h3>
<p>Search for traces using common dimensions such as time range, duration, span tags, service names, etc.
Use the Explore trace view to quickly diagnose errors and high latency events in your system.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_search.png"
  alt="Sample search visualization" width="1794"
     height="816"/></p>
<h3 id="search-is-non-deterministic">Search is non-deterministic</h3>
<p>Most search functions are deterministic.
When given the same criteria, a deterministic algorithm returns consistent results.
For example, let&rsquo;s say that you query a search engine for the definition of &ldquo;traces.&rdquo;
The results list the same top matches for each query for &ldquo;traces&rdquo; in that search engine.</p>
<p>However, Tempo search is non-deterministic.
If you perform the same search twice, youâ€™ll get different lists, assuming the possible number of results for your search is greater than the number of results you have your search set to return.</p>
<p>When performing a search, Tempo does a massively parallel search over the given time range, and takes the first <code>N</code> results.
Even identical searches differ due to things like machine load and network latency.
This approach values speed over predictability and is quite simple; enforcing that the search results are consistent would introduce additional complexity (and increase the time the user spends waiting for results).
TraceQL follows the same behavior.</p>
<p>By adding <code>most_recent=true</code> to your TraceQL queries, the search results become deterministic.
For more information, refer to 
    <a href="/docs/tempo/latest/traceql/#retrieving-most-recent-results-experimental">Retrieve most recent results</a></p>
<h4 id="use-trace-search-results-as-panels-in-dashboards">Use trace search results as panels in dashboards</h4>
<p>You can embed tracing panels and visualizations in dashboards.
You can also save queries as panels.
For more information, refer to the <a href="/docs/grafana-cloud/visualizations/panels-visualizations/visualizations/traces/#add-traceql-with-table-visualizations">Traces Visualization</a> documentation.</p>
<p>For example dashboards, visit <a href="https://play.grafana.org" target="_blank" rel="noopener noreferrer"><code>play.grafana.org</code></a>.</p>
<ul>
<li><a href="https://play.grafana.org/d/fab5705a-e213-4527-8c23-92cb7452e746/traces-and-basic-operations-on-them?orgId=1" target="_blank" rel="noopener noreferrer">Traces and basic operations</a></li>
<li><a href="https://play.grafana.org/explore?schemaVersion=1&amp;panes=%7B%22cf2%22:%7B%22datasource%22:%22grafanacloud-traces%22,%22queries%22:%5B%7B%22refId%22:%22A%22,%22datasource%22:%7B%22type%22:%22tempo%22,%22uid%22:%22grafanacloud-traces%22%7D,%22queryType%22:%22traceqlSearch%22,%22limit%22:20,%22tableType%22:%22traces%22,%22filters%22:%5B%7B%22id%22:%22ab3bc4be%22,%22operator%22:%22%3D%22,%22scope%22:%22span%22%7D%5D%7D%5D,%22range%22:%7B%22from%22:%22now-1h%22,%22to%22:%22now%22%7D%7D%7D&amp;orgId=1" target="_blank" rel="noopener noreferrer">Grafana Explore with a Tempo data source</a></li>
</ul>
<h3 id="use-traceql-to-query-data-and-generate-metrics">Use TraceQL to query data and generate metrics</h3>
<p>Inspired by PromQL and LogQL, TraceQL is a query language designed for selecting traces.</p>
<p>Using Grafana <strong>Explore</strong>, you can search traces.
The default traces search reviews the whole trace.
TraceQL provides a method for formulating precise queries so you can zoom in to the data you need.
Query results return faster because the queries limit what is searched.</p>
<p>You can construct queries using the 
    <a href="/docs/grafana/latest/datasources/tempo/query-editor/traceql-editor/">TraceQL query editor</a> or use the 
    <a href="/docs/grafana/latest/datasources/tempo/query-editor/traceql-search/">Search query type</a>.</p>
<p>For details about constructing queries, refer to the 
    <a href="/docs/tempo/latest/traceql/">TraceQL documentation</a>.</p>
<h4 id="traceql-metrics-queries">TraceQL metrics queries</h4>



<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>TraceQL metrics is an <a href="/docs/release-life-cycle/">experimental feature</a>. Engineering and on-call support is not available. Documentation is either limited or not provided outside of code comments. No SLA is provided. Enable the  feature toggle in Grafana to use this feature. Do not enable this feature in production environments.</p></blockquote></div>


<p>TraceQL language provides metrics queries as an experimental feature.
Metric queries extend trace queries by applying an aggregate function to trace query results. For example: <code>{ span:name = &quot;foo&quot; } | rate() by (span:status)</code>
This powerful feature creates metrics from traces, much in the same way that LogQL metric queries create metrics from logs.</p>
<p><a href="/docs/grafana-cloud/visualizations/simplified-exploration/traces/">Grafana Traces Drilldown</a> is powered by metrics queries.</p>
<p>For more information about available queries, refer to 
    <a href="/docs/tempo/latest/traceql/metrics-queries/">TraceQL metrics queries</a>.</p>
<h3 id="generate-metrics-from-spans">Generate metrics from spans</h3>
<p>RED metrics can drive service graphs and other ready-to-go visualizations of your span data.
RED metrics represent:</p>
<ul>
<li><em>Rate</em>, the number of requests per second</li>
<li><em>Errors</em>, the number of those requests that are failing</li>
<li><em>Duration</em>, the amount of time those requests take</li>
</ul>
<p>For more information about RED method, refer to <a href="/blog/2018/08/02/the-red-method-how-to-instrument-your-services/">The RED Method: how to instrument your services</a>.</p>
<p>To enable metrics-generator in Grafana Cloud, refer to <a href="/docs/grafana-cloud/send-data/traces/metrics-generator/">Enable metrics-generator</a>.</p>
<p>To enable metrics-generator for Tempo, refer to 
    <a href="/docs/tempo/latest/configuration/#metrics-generator">Configure metrics-generator</a>.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_service_graph.png"
  alt="Service graph view" width="1597"
     height="895"/></p>
<p>These metrics exist in your Hosted Metrics instance and can also be easily used to generate powerful custom dashboards.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_custom_metrics_dash.png"
  alt="Custom Metrics Dashboard" width="1611"
     height="776"/></p>
<p>Metrics automatically generate exemplars as well which allows easy metrics to trace linking.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_exemplars.png"
  alt="Trace Exemplars" width="1843"
     height="781"/></p>
<h4 id="service-graph-view">Service graph view</h4>
<p>Service graph view displays a table of request rate, error rate, and duration metrics (RED) calculated from your incoming spans.
It also includes a node graph view built from your spans.</p>
<p>To use the service graph view, you need to enable 
    <a href="/docs/tempo/latest/metrics-generator/service_graphs/">service graphs</a> and 
    <a href="/docs/tempo/latest/metrics-generator/span_metrics/">span metrics</a>.
After it&rsquo;s enabled, this pre-configured view is immediately available in <strong>Explore &gt; Service Graphs</strong>.</p>
<p>Refer to the 
    <a href="https://docs/tempo/latest/metrics-generator/service-graph-view" target="_blank" rel="noopener noreferrer">service graph view documentation</a> for further information.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/apm-overview.png"
  alt="Service graph view overview" width="1266"
     height="915"/></p>
<h2 id="integrate-other-telemetry-signals">Integrate other telemetry signals</h2>
<h3 id="link-traces-and-logs">Link traces and logs</h3>
<p>If you&rsquo;re already doing request/response logging with trace IDs, they can be easily extracted from logs to jump directly to your traces.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_sample.png"
  alt="Logs to Traces visualization" width="1606"
     height="889"/></p>
<p>In the other direction, you can configure Grafana and Grafana Cloud to create a link from an individual span to your Loki logs.
If you see a long-running span or a span with errors, you
can immediately jump to the logs of the process causing the error.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/grafana-cloud/trace_to_logs.png"
  alt="Traces to Logs visualization" width="1584"
     height="883"/></p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Cloud Traces only supports custom tags added by Grafana Support.
Cloud Traces supports these default tags: <code>cluster</code>, <code>hostname</code>, <code>namespace</code>, and <code>pod</code>.
Contact Support to add a custom tag.</p></blockquote></div>

<h3 id="link-traces-and-metrics">Link traces and metrics</h3>
<p>Grafana can correlate different signals by adding the functionality to link between traces and metrics. <a href="/blog/2022/08/18/new-in-grafana-9.1-trace-to-metrics-allows-users-to-navigate-from-a-trace-span-to-a-selected-data-source/">Trace to metrics</a> lets you navigate from a trace span to a selected data source.
Using trace to metrics, you can quickly see trends or aggregated data related to each span.</p>
<p>For example, you can use span attributes to metric labels by using the <code>$__tags</code> keyword to convert span attributes to metrics labels.</p>
<p>To set up Trace to metrics for your data source, refer to <a href="/docs/grafana-cloud/connect-externally-hosted/data-sources/tempo/configure-tempo-data-source/#trace-to-metrics">Trace to metric configuration</a>.</p>


  <div
    class="youtube-lazyload responsive-video"
    data-embed="xOolCpm2F8c"
    data-url="https://www.youtube.com/embed/xOolCpm2F8c?autoplay=1"
    data-title="YouTube Video"
  >
    <div class="play-button"></div>
  </div>
<h3 id="link-traces-and-profiles">Link traces and profiles</h3>
<p>Using Trace to profiles, you can correlate different signals by adding the functionality to link between traces and profiles.</p>
<p>Trace to profiles lets you link your 
    <a href="/docs/pyroscope/latest/">Grafana Pyroscope</a> data source to tracing data in Grafana or Grafana Cloud.
When configured, this connection lets you run queries from a trace span into the profile data.</p>
<p><img
  class="lazyload d-inline-block"
  data-src="/static/img/docs/tempo/profiles/tempo-profiles-Span-link-profile-data-source.png"
  alt="Selecting a link in the span queries the profile data source" width="1681"
     height="1102"/></p>
<p>For more information, refer to the 
    <a href="/docs/grafana/latest/datasources/tempo/configure-tempo-data-source/#trace-to-profiles">Traces to profiles documentation</a> and the 
    <a href="https://docs/grafana/latest/datasources/grafana-pyroscope/" target="_blank" rel="noopener noreferrer">Grafana Pyroscope data source documentation</a>.</p>
<p>For Cloud Traces, Refer to the <a href="/docs/grafana-cloud/connect-externally-hosted/data-sources/tempo/configure-tempo-data-source/#trace-to-profiles">Traces to profiles documentation</a> for configuration instructions.</p>


  <div
    class="youtube-lazyload responsive-video"
    data-embed="AG8VzfFMLxo"
    data-url="https://www.youtube.com/embed/AG8VzfFMLxo?autoplay=1"
    data-title="YouTube Video"
  >
    <div class="play-button"></div>
  </div>
</div>

        
