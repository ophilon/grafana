<!DOCTYPE html>
<h1 id="activate-a-grafana-enterprise-license-from-aws-on-an-instance-deployed-outside-of-aws">Activate a Grafana Enterprise license from AWS on an instance deployed outside of AWS</h1>
<p>While AWS Marketplace lists ECS and EKS as the supported environments for Grafana Enterprise, you can apply a Grafana Enterprise license from AWS Marketplace to any Grafana instance with network access to the AWS licensing service.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li>Purchase a subscription to <a href="https://aws.amazon.com/marketplace/pp/prodview-dlncd4kzt5kx6" target="_blank" rel="noopener noreferrer">Grafana Enterprise from AWS Marketplace</a>.</li>
<li>Be sure that the IAM user that was used to purchase Grafana Enterprise has permission to manage subscriptions, create new IAM users, and create access policies.</li>
<li>Be sure there is network access between AWS and the environment where you intend to run Grafana. Network access is required because your Grafana instance communicates with the <a href="https://docs.aws.amazon.com/general/latest/gr/licensemanager.html" target="_blank" rel="noopener noreferrer">AWS License Manager endpoints and quotas</a> to retrieve license and subscription information. Grafana instances with access to the public internet will have access to AWS license manager.</li>
</ul>
<p>To activate a Grafana Enterprise license from AWS on a Grafana Enterprise instance deployed outside of AWS, complete the following tasks.</p>
<h2 id="task-1-install-grafana-enterprise">Task 1: Install Grafana Enterprise</h2>
<p>To install Grafana, refer to the documentation specific to your implementation.</p>
<ul>
<li><a href="../../../../setup-grafana/installation/">Install Grafana</a>.</li>
<li><a href="../../../../setup-grafana/installation/docker/">Run Grafana Docker image</a>.</li>
<li><a href="../../../../setup-grafana/installation/kubernetes/#deploy-grafana-enterprise-on-kubernetes">Deploy Grafana on Kubernetes</a>.</li>
</ul>
<h2 id="task-2-create-an-aws-iam-user-with-access-to-your-grafana-enterprise-license">Task 2: Create an AWS IAM user with access to your Grafana Enterprise license</h2>
<p>To retrieve your license, Grafana Enterprise requires access to your AWS account and license information. To grant access, create an IAM user in AWS with access to the license, and pass its credentials as environment variables on the host or container where Grafana is running. These environment variables allow Grafana to retrieve license details from AWS.</p>
<ol>
<li>
<p>In the AWS License Manager service, create an IAM policy with the following permissions:</p>
<ul>
<li><code>&quot;license-manager:CheckoutLicense&quot;</code></li>
<li><code>&quot;license-manager:ListReceivedLicenses&quot;</code></li>
<li><code>&quot;license-manager:GetLicenseUsage&quot;</code></li>
<li><code>&quot;license-manager:CheckInLicense&quot;</code></li>
</ul>
<p>For more information about creating a policy in AWS, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html" target="_blank" rel="noopener noreferrer">Creating IAM policies</a>.</p>
<p>For more information about AWS Identity and Access Management, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html" target="_blank" rel="noopener noreferrer">IAM users</a>.</p>
</li>
<li>
<p>To limit the policy to obtain usage data just for Grafana Enterprise, in the <strong>Resources</strong> section of the policy, specify your license ARN.</p>
<p>You can find your license ID in the <strong>Granted Licenses</strong> section of <a href="https://console.aws.amazon.com/license-manager/home" target="_blank" rel="noopener noreferrer">AWS License Manager</a>.</p>
<p>The policy JSON should look similar to the following example:</p>
<pre>{
   &#34;Version&#34;: &#34;2012-10-17&#34;,
   &#34;Statement&#34;: [
      {
            &#34;Sid&#34;: &#34;VisualEditor0&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: &#34;license-manager:GetLicenseUsage&#34;,
            &#34;Resource&#34;: &#34;arn:aws:license-manager::[YOUR_ACCOUNT]:license:[YOUR_LICENSE_ID]&#34;
      },
      {
            &#34;Sid&#34;: &#34;VisualEditor1&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: [
               &#34;license-manager:CheckoutLicense&#34;,
               &#34;license-manager:ListReceivedLicenses&#34;,
               &#34;license-manager:CheckInLicense&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;
      }
   ]
}</pre>
</li>
<li>
<p>Create an IAM user and choose access key credentials as its authentication method.</p>
<p>For more information about creating an IAM user, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html" target="_blank" rel="noopener noreferrer">IAM users</a>.</p>
<p>For more information about access key credentials, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" target="_blank" rel="noopener noreferrer">Managing access keys for IAM users</a>.</p>
</li>
<li>
<p>Attach the policy you created to the IAM user.</p>
</li>
<li>
<p>Add the following values as environment variables to the host or container running Grafana:</p>
<ul>
<li>AWS region</li>
<li>IAM user&rsquo;s access key ID</li>
<li>IAM user&rsquo;s secret access key</li>
</ul>
<p>The environment variables should look similar to the following example:</p>
<pre>AWS_ACCESS_KEY_ID=ABCD5E75FGHIJKTM7
AWS_SECRET_ACCESS_KEY=k8fhYAQVy+5NhCejhe6HeSjSphjRuy+12C06
AWS_REGION=us-east-1</pre>
</li>
</ol>
<h2 id="task-3-configure-grafana-enterprise-to-validate-its-license-with-aws">Task 3: Configure Grafana Enterprise to validate its license with AWS</h2>
<p>In this task you configure Grafana Enterprise to validate the license with AWS instead of Grafana Labs.</p>
<p>Choose one of the following options to update the <a href="../../../../setup-grafana/configure-grafana/enterprise-configuration/#license_validation_type">license_validation_type</a> configuration to <code>aws</code>:</p>
<ul>
<li>
<p><strong>Option 1:</strong> In the <code>[enterprise]</code> section of the grafana.ini configuration file, add <code>license_validation_type=aws</code>.</p>
<p>For example:</p>
<pre>[enterprise]
license_validation_type=aws</pre>
</li>
<li>
<p><strong>Option 2:</strong> Add the following environment variable to the container or host:</p>
<pre>GF_ENTERPRISE_LICENSE_VALIDATION_TYPE=aws</pre>
</li>
</ul>
<h2 id="task-4-start-or-restart-grafana">Task 4: Start or restart Grafana</h2>
<p>To activate Grafana Enterprise features, start (or restart) Grafana.</p>
<p>For information about restarting Grafana, refer to <a href="../../../../setup-grafana/start-restart-grafana/">Restart Grafana</a>.</p>
