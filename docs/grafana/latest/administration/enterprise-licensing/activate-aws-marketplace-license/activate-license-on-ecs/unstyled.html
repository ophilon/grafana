<!DOCTYPE html>
<h1 id="activate-a-grafana-enterprise-license-from-aws-marketplace-on-ecs">Activate a Grafana Enterprise license from AWS Marketplace on ECS</h1>
<p>If you have purchased a Grafana Enterprise subscription through AWS Marketplace, you must activate it in order to use Grafana Enterprise data source plugins and features in Grafana.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li>Purchase a subscription to <a href="https://aws.amazon.com/marketplace/pp/prodview-dlncd4kzt5kx6" target="_blank" rel="noopener noreferrer">Grafana Enterprise from AWS Marketplace</a>.</li>
<li>Be sure that the IAM user that was used to purchase Grafana Enterprise has permission to manage subscriptions, create new IAM users and roles, and create access policies.</li>
</ul>
<p>To activate your license, complete the following tasks.</p>
<h2 id="task-1-deploy-grafana-enterprise-on-amazon-ecs">Task 1: Deploy Grafana Enterprise on Amazon ECS</h2>
<ol>
<li>
<p>Deploy Grafana Enterprise on Amazon ECS.</p>
<p>For more information about deploying an application on Amazon ECS, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-service.html" target="_blank" rel="noopener noreferrer">Creating an Amazon ECS service</a>.</p>
</li>
<li>
<p>As you create the Amazon ECS service, use the intended Grafana Enterprise container image version.</p>
<p>For example, enter <code>grafana/grafana-enterprise:11.3.0</code>.</p>
<blockquote>
<p>Only Grafana Enterprise versions 8.3.0 and later support licenses granted through AWS Marketplace.</p></blockquote>
</li>
</ol>
<h2 id="task-2-configure-grafana-for-high-availability">Task 2: Configure Grafana for high availability</h2>
<p>Grafana requires that you configure a database to hold dashboards, users, and other persistent data.</p>
<h3 id="before-you-begin-1">Before you begin</h3>
<ul>
<li>Ensure that you have a supported Grafana database available.
<ul>
<li>For a list of supported databases, refer to <a href="../../../../setup-grafana/installation/#supported-databases">Supported databases</a>.</li>
<li>For information about creating a database, refer to <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_CreateDBInstance.html" target="_blank" rel="noopener noreferrer">Creating an Amazon RDS DB instance</a>.</li>
</ul>
</li>
<li>Review the information required to connect to the RDS DB instance. For more information, refer to <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_CommonTasks.Connect.html" target="_blank" rel="noopener noreferrer">Connecting to an Amazon RDS DB instance</a>.</li>
</ul>
<p>To configure Grafana for high availability:</p>
<ol>
<li>
<p>In AWS ECS, use environment variables to update the <code>database</code> parameters.</p>
<p>For a list of database parameters, refer to <a href="../../../../setup-grafana/configure-grafana/#database">Configuration</a>.</p>
</li>
<li>
<p>Create a revision of the task definition for the ECS Task that runs Grafana Enterprise.</p>
<p>For more information about creating a task, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-task-definition.html" target="_blank" rel="noopener noreferrer">Updating a task definition using the classic console</a>.</p>
</li>
<li>
<p>Within the new revision, edit the Grafana Enterprise container for this task, and add the following environment variables to the container:</p>
<pre>GF_DATABASE_TYPE=[database type]
GF_DATABASE_HOST=[database address and port]
GF_DATABASE_NAME=[database name]
GF_DATABASE_USER=[database username]
GF_DATABASE_PASSWORD=[database password]</pre>
</li>
</ol>
<blockquote>
<p>For more information about how to update your ECS service with an environment variable, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-service-console-v2.html" target="_blank" rel="noopener noreferrer">Updating a service using the new console</a>.</p></blockquote>
<h2 id="task-3-configure-grafana-enterprise-to-validate-its-license-with-aws">Task 3: Configure Grafana Enterprise to validate its license with AWS</h2>
<p>In this task you configure Grafana Enterprise to validate the license with AWS instead of Grafana Labs.</p>
<ol>
<li>
<p>In AWS IAM, create an access policy with the following permissions:</p>
<ul>
<li><code>&quot;license-manager:CheckoutLicense&quot;</code></li>
<li><code>&quot;license-manager:ListReceivedLicenses&quot;</code></li>
<li><code>&quot;license-manager:GetLicenseUsage&quot;</code></li>
<li><code>&quot;license-manager:CheckInLicense&quot;</code></li>
</ul>
<p>For more information about creating an access policy, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create-console.html" target="_blank" rel="noopener noreferrer">Creating IAM policies (console)</a>.</p>
<p>For more information about AWS license permissions, refer to <a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_awslicensemanager.html" target="_blank" rel="noopener noreferrer">Actions, resources, and condition keys for AWS License Manager</a>.</p>
</li>
<li>
<p>Create an Elastic Container Service task role and attach the policy you created in the previous step.</p>
<p>For more information about creating a task role, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html" target="_blank" rel="noopener noreferrer">IAM Roles for Tasks</a>.</p>
</li>
<li>
<p>Create a revision of the task definition for the ECS Task that runs Grafana Enterprise.</p>
<p>For more information about creating a revision of the task definition, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-task-definition.html" target="_blank" rel="noopener noreferrer">Updating a task definition using the classic console</a>.</p>
</li>
<li>
<p>Within the new revision, perform the following steps:</p>
<p>a. Update the Task Role of your ECS Task to the role that you created, with permission to access license information.</p>
<p>b. Edit the Grafana Enterprise container for this task, and add the following environment variable to the container:</p>
<pre>GF_ENTERPRISE_LICENSE_VALIDATION_TYPE=aws</pre>
<p>For more information about how to update your ECS service with an environment variable, refer to <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-service-console-v2.html" target="_blank" rel="noopener noreferrer">Updating a service using the new console</a>.</p>
</li>
</ol>
<h3 id="task-4-start-or-restart-grafana">Task 4: Start or restart Grafana</h3>
<ol>
<li>To restart Grafana and activate your license, update the service running Grafana to use the latest revision of the task definition that you created.</li>
<li>After you update the service, navigate to your Grafana instance, sign in with Grafana Admin credentials, and navigate to <strong>Administration &gt; General &gt; Stats and license</strong> to validate that your license is active.</li>
</ol>
<p>For more information about validating that your license is active, refer to <a href="../../#grafana-enterprise-license-restrictions">Grafana Enterprise license restrictions</a>.</p>
