<!DOCTYPE html>
<h1 id="integrate-hubot-with-grafana">Integrate Hubot with Grafana</h1>
<p>Grafana 2.0 shipped with a great feature that enables it to render any graph or panel to a PNG image.</p>
<p>No matter what data source you are using, the PNG image of the Graph will look the same as it does in your browser.</p>
<p>This guide shows you how to install and configure the <a href="https://github.com/stephenyeargin/hubot-grafana" target="_blank" rel="noopener noreferrer">Hubot-Grafana</a> plugin. This plugin allows you to tell Hubot to render any dashboard or graph right from a channel in Slack, Basecamp, or any other supported Hubot adapter. The bot will respond with an image of the graph and a link that will take you to the graph.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 800px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/static/img/docs/tutorials/hubot_grafana.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/static/img/docs/tutorials/hubot_grafana.png"data-srcset="/static/img/docs/tutorials/hubot_grafana.png?w=320 320w, /static/img/docs/tutorials/hubot_grafana.png?w=550 550w, /static/img/docs/tutorials/hubot_grafana.png?w=750 750w, /static/img/docs/tutorials/hubot_grafana.png?w=900 900w, /static/img/docs/tutorials/hubot_grafana.png?w=1040 1040w, /static/img/docs/tutorials/hubot_grafana.png?w=1240 1240w, /static/img/docs/tutorials/hubot_grafana.png?w=1920 1920w"
          data-sizes="auto"alt=""width="501"height="302"/>
        <noscript>
          <img
            src="/static/img/docs/tutorials/hubot_grafana.png"
            alt=""width="501"height="302"/>
        </noscript></div></a></figure>
<h2 id="what-is-hubot">What is Hubot?</h2>
<p><a href="https://hubot.github.com/" target="_blank" rel="noopener noreferrer">Hubot</a> is an universal and extensible chat bot that can be used with many chat services and has a huge library of third party plugins that allow you to automate anything from your chat rooms.</p>
<h2 id="install-hubot">Install Hubot</h2>
<p>Hubot is very easy to install and host. If you do not already have a bot up and running please read the official <a href="https://hubot.github.com/docs/" target="_blank" rel="noopener noreferrer">Getting Started With Hubot</a> guide.</p>
<h2 id="install-the-hubot-grafana-script">Install the Hubot-Grafana script</h2>
<p>In your Hubot project repo install the Grafana plugin using <code>npm</code>:</p>
<pre>npm install hubot-grafana --save</pre>
<p>Edit the file external-scripts.json, and add hubot-grafana to the list of plugins.</p>
<pre>[&#34;hubot-pugme&#34;, &#34;hubot-shipit&#34;, &#34;hubot-grafana&#34;]</pre>
<h2 id="configure">Configure</h2>
<p>The Hubot-Grafana plugin requires two environment variables to be set in order to work properly.</p>
<pre>export HUBOT_GRAFANA_HOST=https://play.grafana.org
export HUBOT_GRAFANA_API_KEY=abcd01234deadbeef01234</pre>
<p>There are <a href="https://github.com/stephenyeargin/hubot-grafana?tab=readme-ov-file#general-settings" target="_blank" rel="noopener noreferrer">additional environment variables</a> that you can set to control the appearance of the graphs.</p>
<h3 id="grafana-server-side-rendering">Grafana server side rendering</h3>
<p>The hubot plugin will take advantage of the Grafana server side rendering feature that can render any panel on the server using phantomjs. Grafana ships with a phantomjs binary (Linux only).</p>
<p>To verify that this feature works try the <code>Direct link to rendered image</code> link in the panel share dialog. If you do not get an image when opening this link verify that the required font packages are installed for phantomjs to work.</p>
<h3 id="grafana-api-key">Grafana API Key</h3>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p docs-image--right"
    style="max-width: 150px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/static/img/docs/v2/orgdropdown_api_keys.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/static/img/docs/v2/orgdropdown_api_keys.png"data-srcset="/static/img/docs/v2/orgdropdown_api_keys.png?w=320 320w, /static/img/docs/v2/orgdropdown_api_keys.png?w=550 550w, /static/img/docs/v2/orgdropdown_api_keys.png?w=750 750w, /static/img/docs/v2/orgdropdown_api_keys.png?w=900 900w, /static/img/docs/v2/orgdropdown_api_keys.png?w=1040 1040w, /static/img/docs/v2/orgdropdown_api_keys.png?w=1240 1240w, /static/img/docs/v2/orgdropdown_api_keys.png?w=1920 1920w"
          data-sizes="auto"alt=""width="254"height="429"/>
        <noscript>
          <img
            src="/static/img/docs/v2/orgdropdown_api_keys.png"
            alt=""width="254"height="429"class="docs-image--right"/>
        </noscript></div></a></figure>
<p>You need to set the environment variable <code>HUBOT_GRAFANA_API_KEY</code> to a Grafana API Key. You can add these from the API Keys page which you find in the Organization dropdown.</p>
<h3 id="image-uploading">Image uploading</h3>
<p>There are several approaches to uploading the rendered graphs. If you are using Slack, Rocket.Chat, or Telegram, the adapter&rsquo;s native uploader will take care of sending it through their respective API. If your Hubot is hosted on a platform that doesn&rsquo;t support uploads (such as IRC), you can use the <a href="https://github.com/stephenyeargin/hubot-grafana/wiki/Amazon-S3-Image-Hosting" target="_blank" rel="noopener noreferrer">built-in S3 uploader</a>. Note if you configure S3, it will not use the adapter&rsquo;s upload features.</p>
<h2 id="hubot-commands">Hubot commands</h2>
<ul>
<li><code>hubot graf list</code>
<ul>
<li>Lists the available dashboards</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics</code>
<ul>
<li>Graph all panels in the dashboard</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics:3</code>
<ul>
<li>Graph only panel with id 3 of a particular dashboard</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics:cpu</code>
<ul>
<li>Graph only the panels containing &ldquo;cpu&rdquo; (case insensitive) in the title</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics now-12hr</code>
<ul>
<li>Get a dashboard with a window of 12 hours ago to now</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics now-24hr now-12hr</code>
<ul>
<li>Get a dashboard with a window of 24 hours ago to 12 hours ago</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics:3 now-8d now-1d</code>
<ul>
<li>Get only the third panel of a particular dashboard with a window of 8 days ago to yesterday</li>
</ul>
</li>
<li><code>hubot graf db graphite-carbon-metrics host=carbon-a</code>
<ul>
<li>Get a templated dashboard with the <code>$host</code> parameter set to <code>carbon-a</code></li>
</ul>
</li>
</ul>
<h2 id="aliases">Aliases</h2>
<p>Some of the hubot commands above can lengthy and you might have to remember the dashboard slug (url id). If you have a few favorite graphs you want to be able check up on often (let&rsquo;s say from your mobile) you can create hubot command aliases with the hubot script <code>hubot-alias</code>.</p>
<p>Install it:</p>
<pre>npm i --save hubot-alias</pre>
<p>Now add <code>hubot-alias</code> to the list of plugins in <code>external-scripts.json</code> and restart hubot.</p>
<p>Now you can add an alias like this:</p>
<ul>
<li><code>hubot alias graf-lb=graf db loadbalancers:2 now-20m</code></li>
</ul>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 800px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/static/img/docs/tutorials/hubot_grafana2.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/static/img/docs/tutorials/hubot_grafana2.png"data-srcset="/static/img/docs/tutorials/hubot_grafana2.png?w=320 320w, /static/img/docs/tutorials/hubot_grafana2.png?w=550 550w, /static/img/docs/tutorials/hubot_grafana2.png?w=750 750w, /static/img/docs/tutorials/hubot_grafana2.png?w=900 900w, /static/img/docs/tutorials/hubot_grafana2.png?w=1040 1040w, /static/img/docs/tutorials/hubot_grafana2.png?w=1240 1240w, /static/img/docs/tutorials/hubot_grafana2.png?w=1920 1920w"
          data-sizes="auto"alt=""width="530"height="314"/>
        <noscript>
          <img
            src="/static/img/docs/tutorials/hubot_grafana2.png"
            alt=""width="530"height="314"/>
        </noscript></div></a></figure>
<h2 id="summary">Summary</h2>
<p>Grafana is going to ship with integrated Slack and Hipchat features some day but you do not have to wait for that. Grafana 2 shipped with a very clever server side rendering feature that can render any panel to a png using phantomjs. The hubot plugin for Grafana is something you can install and use today!</p>
