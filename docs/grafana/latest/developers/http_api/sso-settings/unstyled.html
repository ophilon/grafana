<!DOCTYPE html>
<h1 id="sso-settings-api">SSO Settings API</h1>
<blockquote>
<p>If you are running Grafana Enterprise, for some endpoints you&rsquo;ll need to have specific permissions. Refer to <a href="/docs/grafana/latest/administration/roles-and-permissions/access-control/custom-role-actions-scopes/">Role-based access control permissions</a> for more information.</p></blockquote>
<p>The API can be used to create, update, delete, get, and list SSO Settings for OAuth2 and SAML.</p>
<p>The settings managed by this API are stored in the database and override
<a href="../../../setup-grafana/configure-security/configure-authentication/">settings from other sources</a>
(arguments, environment variables, settings file, etc).
Therefore, every time settings for a specific provider are removed or reset to the default settings at runtime,
the settings are inherited from the other sources in the reverse order of precedence
(<code>arguments &gt; environment variables &gt; settings file</code>).</p>
<h2 id="list-sso-settings">List SSO Settings</h2>
<p><code>GET /api/v1/sso-settings</code></p>
<p>Lists the SSO Settings for all providers.</p>
<p>The providers or SSO keys that are not managed by this API are retrieved from the other sources (settings file, environment variables, default values).</p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#sso-settings">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>settings:read</code></td>
          <td><code>settings:auth.{provider}:*</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Example Request</strong>:</p>
<pre>GET /api/v1/sso-settings HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json
[
  {
    &#34;id&#34;:        &#34;1&#34;,
    &#34;provider&#34;:  &#34;github&#34;,
    &#34;settings&#34;: {
      &#34;apiUrl&#34;: &#34;https://api.github.com/user&#34;,
      &#34;clientId&#34;: &#34;my_github_client&#34;,
      &#34;clientSecret&#34;: &#34;*********&#34;,
      &#34;enabled&#34;: true,
      &#34;scopes&#34;: &#34;user:email,read:org&#34;
      // rest of the settings
    },
    &#34;source&#34;:    &#34;system&#34;,
  },
  {
    &#34;id&#34;:        &#34;2&#34;,
    &#34;provider&#34;:  &#34;azuread&#34;,
    &#34;settings&#34;: {
      &#34;authUrl&#34;: &#34;https://login.microsoftonline.com/00000000-0000-0000-0000-000000000000/oauth2/v2.0/authorize&#34;,
      &#34;clientId&#34;: &#34;my_azuread_client&#34;,
      &#34;clientSecret&#34;: &#34;*********&#34;,
      &#34;enabled&#34;: true,
      &#34;scopes&#34;: &#34;openid,email,profile&#34;
      // rest of the settings
    },
    &#34;source&#34;:    &#34;system&#34;,
  }
]</pre>
<p>Status Codes:</p>
<ul>
<li><strong>200</strong> – SSO Settings found</li>
<li><strong>400</strong> – Bad Request</li>
<li><strong>401</strong> – Unauthorized</li>
<li><strong>403</strong> – Access Denied</li>
</ul>
<h2 id="get-sso-settings">Get SSO Settings</h2>
<p><code>GET /api/v1/sso-settings/:provider</code></p>
<p>Gets the SSO Settings for a provider.</p>
<p>The SSO keys that are not managed by this API are retrieved from the other sources (settings file, environment variables, default values).</p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#sso-settings">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>settings:read</code></td>
          <td><code>settings:auth.{provider}:*</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Example Request</strong>:</p>
<pre>GET /api/v1/sso-settings/github HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json
ETag: db87f729761898ee
{
  &#34;id&#34;:        &#34;1&#34;,
  &#34;provider&#34;:  &#34;github&#34;,
  &#34;settings&#34;: {
    &#34;apiUrl&#34;: &#34;https://api.github.com/user&#34;,
    &#34;clientId&#34;: &#34;my_github_client&#34;,
    &#34;clientSecret&#34;: &#34;*********&#34;,
    &#34;enabled&#34;: true,
    &#34;scopes&#34;: &#34;user:email,read:org&#34;
    // rest of the settings
  },
  &#34;source&#34;:    &#34;system&#34;,
}</pre>
<p>Status Codes:</p>
<ul>
<li><strong>200</strong> – SSO Settings found</li>
<li><strong>400</strong> – Bad Request</li>
<li><strong>401</strong> – Unauthorized</li>
<li><strong>403</strong> – Access Denied</li>
<li><strong>404</strong> – SSO Settings not found</li>
</ul>
<h2 id="update-sso-settings">Update SSO Settings</h2>
<p><code>PUT /api/v1/sso-settings/:provider</code></p>
<p>Updates the SSO Settings for a provider.</p>
<p>When you submit new settings for a provider via API,
Grafana verifies whether the given settings are allowed and valid.
If they are, then Grafana stores the settings in the database and reloads
Grafana services with no need to restart the instance.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If you run Grafana in high availability mode, configuration changes
may not get applied to all Grafana instances immediately. You may need
to wait a few minutes for the configuration to propagate to all Grafana instances.</p></blockquote></div>

<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#sso-settings">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>settings:write</code></td>
          <td><code>settings:auth.{provider}:*</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Example Request</strong>:</p>
<pre>PUT /api/v1/sso-settings/github HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk

{
  &#34;settings&#34;: {
    &#34;apiUrl&#34;: &#34;https://api.github.com/user&#34;,
    &#34;clientId&#34;: &#34;my_github_client&#34;,
    &#34;clientSecret&#34;: &#34;my_github_secret&#34;,
    &#34;enabled&#34;: true,
    &#34;scopes&#34;: &#34;user:email,read:org&#34;
  }
}</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 204
Content-Type: application/json</pre>
<p>Status Codes:</p>
<ul>
<li><strong>204</strong> – SSO Settings updated</li>
<li><strong>400</strong> – Bad Request</li>
<li><strong>401</strong> – Unauthorized</li>
<li><strong>403</strong> – Access Denied</li>
</ul>
<h2 id="delete-sso-settings">Delete SSO Settings</h2>
<p><code>DELETE /api/v1/sso-settings/:provider</code></p>
<p>Deletes an existing SSO Settings entry for a provider.</p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#sso-settings">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>settings:write</code></td>
          <td><code>settings:auth.{provider}:*</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Example Request</strong>:</p>
<pre>DELETE /api/v1/sso-settings/azuread HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 204
Content-Type: application/json</pre>
<p>Status Codes:</p>
<ul>
<li><strong>204</strong> – SSO Settings deleted</li>
<li><strong>400</strong> – Bad Request</li>
<li><strong>401</strong> – Unauthorized</li>
<li><strong>403</strong> – Access Denied</li>
<li><strong>404</strong> – SSO Settings not found</li>
</ul>
