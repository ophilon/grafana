<!DOCTYPE html>
<h1 id="query-and-resource-caching-api">Query and resource caching API</h1>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If you are running Grafana Enterprise, for some endpoints you&rsquo;ll need to have specific permissions. Refer to <a href="/docs/grafana/latest/administration/roles-and-permissions/access-control/custom-role-actions-scopes/">Role-based access control permissions</a> for more information.</p></blockquote></div>

<h2 id="enable-caching-for-a-data-source">Enable caching for a data source</h2>
<p><code>POST /api/datasources/:dataSourceUID/cache/enable</code></p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#query-and-resource-caching-api">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>datasources.caching:write</td>
          <td>datasources:*</td>
      </tr>
  </tbody>
</table>
<h3 id="examples">Examples</h3>
<p><strong>Example Request</strong>:</p>
<pre>POST /api/datasources/jZrmlLCGka/cache/enable HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json

{
   &#34;message&#34;: &#34;Data source cache enabled&#34;,
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: true,
   &#34;ttlQueriesMs&#34;: 300000,
   &#34;ttlResourcesMs&#34;: 300000,
   &#34;useDefaultTTL&#34;: true,
   &#34;defaultTTLMs&#34;: 300000,
   &#34;created&#34;: &#34;2023-04-21T11:49:22-04:00&#34;,
   &#34;updated&#34;: &#34;2023-04-24T16:30:29-04:00&#34;
}</pre>
<h4 id="status-codes">Status codes</h4>
<table>
  <thead>
      <tr>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
          <td>Cache was successfully enabled for the data source</td>
      </tr>
      <tr>
          <td>500</td>
          <td>Unexpected error. Refer to the body and/or server logs for more details.</td>
      </tr>
  </tbody>
</table>
<h2 id="disable-caching-for-a-data-source">Disable caching for a data source</h2>
<p><code>POST /api/datasources/:dataSourceUID/cache/disable</code></p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#query-and-resource-caching-api">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>datasources.caching:write</td>
          <td>datasources:*</td>
      </tr>
  </tbody>
</table>
<h3 id="examples-1">Examples</h3>
<p><strong>Example Request</strong>:</p>
<pre>POST /api/datasources/jZrmlLCGka/cache/disable HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json

{
   &#34;message&#34;: &#34;Data source cache disabled&#34;,
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: false,
   &#34;ttlQueriesMs&#34;: 300000,
   &#34;ttlResourcesMs&#34;: 300000,
   &#34;useDefaultTTL&#34;: true,
   &#34;defaultTTLMs&#34;: 0,
   &#34;created&#34;: &#34;2023-04-21T11:49:22-04:00&#34;,
   &#34;updated&#34;: &#34;2023-04-24T16:30:31-04:00&#34;
}</pre>
<h4 id="status-codes-1">Status codes</h4>
<table>
  <thead>
      <tr>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
          <td>Cache was successfully enabled for the data source</td>
      </tr>
      <tr>
          <td>500</td>
          <td>Unexpected error. Refer to the body and/or server logs for more details.</td>
      </tr>
  </tbody>
</table>
<h2 id="clean-cache-for-all-data-sources">Clean cache for all data sources</h2>
<p><code>POST /api/datasources/:dataSourceUID/cache/clean</code></p>
<p>Will clean cached data for <em>all</em> data sources with caching enabled. The <code>dataSourceUID</code> specified will only be used to return the configuration for that data source.</p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#query-and-resource-caching-api">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>datasources.caching:write</td>
          <td>datasources:*</td>
      </tr>
  </tbody>
</table>
<h3 id="examples-2">Examples</h3>
<p><strong>Example Request</strong>:</p>
<pre>POST /api/datasources/jZrmlLCGka/cache/clean HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json

{
   &#34;message&#34;: &#34;Data source cache cleaned&#34;,
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: false,
   &#34;ttlQueriesMs&#34;: 300000,
   &#34;ttlResourcesMs&#34;: 300000,
   &#34;useDefaultTTL&#34;: true,
   &#34;defaultTTLMs&#34;: 0,
   &#34;created&#34;: &#34;2023-04-21T11:49:22-04:00&#34;,
   &#34;updated&#34;: &#34;2023-04-24T16:30:31-04:00&#34;
}</pre>
<h4 id="status-codes-2">Status codes</h4>
<table>
  <thead>
      <tr>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
          <td>Cache was successfully enabled for the data source</td>
      </tr>
      <tr>
          <td>500</td>
          <td>Unexpected error. Refer to the body and/or server logs for more details.</td>
      </tr>
  </tbody>
</table>
<h2 id="update-cache-configuration-for-a-data-source">Update cache configuration for a data source</h2>
<p><code>POST /api/datasources/:dataSourceUID/cache</code></p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#query-and-resource-caching-api">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>datasources.caching:write</td>
          <td>datasources:*</td>
      </tr>
  </tbody>
</table>
<h3 id="examples-3">Examples</h3>
<p><strong>Example Request</strong>:</p>
<pre>POST /api/datasources/jZrmlLCGka/cache HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk

{
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: true,
   &#34;useDefaultTTL&#34;: false,
   &#34;ttlQueriesMs&#34;: 60000,
   &#34;ttlResourcesMs&#34;: 300000,
}</pre>
<h4 id="json-body-schema">JSON Body Schema</h4>
<table>
  <thead>
      <tr>
          <th>Field name</th>
          <th>Data type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>dataSourceID</td>
          <td>number</td>
          <td>The ID of the data source to configure.</td>
      </tr>
      <tr>
          <td>dataSourceUID</td>
          <td>string</td>
          <td>The UID of the data source to configure.</td>
      </tr>
      <tr>
          <td>enabled</td>
          <td>boolean</td>
          <td>Whether or not to enable caching for this data source.</td>
      </tr>
      <tr>
          <td>useDefaultTTL</td>
          <td>boolean</td>
          <td>Whether the configured default TTL (Time-To-Live) should be used for both query and resource caching, instead of the user-specified values.</td>
      </tr>
      <tr>
          <td>ttlQueriesMs</td>
          <td>number</td>
          <td>The TTL to use for query caching, in milliseconds.</td>
      </tr>
      <tr>
          <td>ttlResourcesMs</td>
          <td>number</td>
          <td>The TTL to use for resource caching, in milliseconds.</td>
      </tr>
  </tbody>
</table>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json

{
   &#34;message&#34;: &#34;Data source cache settings updated&#34;,
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: true,
   &#34;useDefaultTTL&#34;: false,
   &#34;ttlQueriesMs&#34;: 60000,
   &#34;ttlResourcesMs&#34;: 300000,
   &#34;defaultTTLMs&#34;: 300000,
   &#34;created&#34;: &#34;2023-04-21T11:49:22-04:00&#34;,
   &#34;updated&#34;: &#34;2023-04-24T17:03:40-04:00&#34;
}</pre>
<h4 id="status-codes-3">Status codes</h4>
<table>
  <thead>
      <tr>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
          <td>Cache was successfully enabled for the data source</td>
      </tr>
      <tr>
          <td>400</td>
          <td>Request errors (invalid json, missing or invalid fields, etc)</td>
      </tr>
      <tr>
          <td>500</td>
          <td>Unexpected error. Refer to the body and/or server logs for more details.</td>
      </tr>
  </tbody>
</table>
<h2 id="get-cache-configuration-for-a-data-source">Get cache configuration for a data source</h2>
<p><code>GET /api/datasources/:dataSourceUID/cache</code></p>
<p><strong>Required permissions</strong></p>
<p>See note in the <a href="#query-and-resource-caching-api">introduction</a> for an explanation.</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Scope</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>datasources.caching:read</td>
          <td>datasources:*</td>
      </tr>
  </tbody>
</table>
<h3 id="examples-4">Examples</h3>
<p><strong>Example Request</strong>:</p>
<pre>GET /api/datasources/jZrmlLCGka/cache HTTP/1.1
Accept: application/json
Content-Type: application/json
Authorization: Bearer eyJrIjoiT0tTcG1pUlY2RnVKZTFVaDFsNFZXdE9ZWmNrMkZYbk</pre>
<p><strong>Example Response</strong>:</p>
<pre>HTTP/1.1 200
Content-Type: application/json

{
   &#34;message&#34;: &#34;Data source cache settings loaded&#34;,
   &#34;dataSourceID&#34;: 1,
   &#34;dataSourceUID&#34;: &#34;jZrmlLCGka&#34;,
   &#34;enabled&#34;: true,
   &#34;useDefaultTTL&#34;: false,
   &#34;ttlQueriesMs&#34;: 60000,
   &#34;ttlResourcesMs&#34;: 300000,
   &#34;defaultTTLMs&#34;: 300000,
   &#34;created&#34;: &#34;2023-04-21T11:49:22-04:00&#34;,
   &#34;updated&#34;: &#34;2023-04-24T17:03:40-04:00&#34;
}</pre>
<h4 id="status-codes-4">Status codes</h4>
<table>
  <thead>
      <tr>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
          <td>Cache was successfully enabled for the data source</td>
      </tr>
      <tr>
          <td>500</td>
          <td>Unexpected error. Refer to the body and/or server logs for more details.</td>
      </tr>
  </tbody>
</table>
