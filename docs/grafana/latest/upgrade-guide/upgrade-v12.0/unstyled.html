<!DOCTYPE html>
<h1 id="upgrade-to-grafana-v120">Upgrade to Grafana v12.0</h1>


<div data-shared="upgrade/intro_2.md">
            <p>We recommend that you upgrade Grafana often to stay current with the latest fixes and enhancements.
Because Grafana upgrades are backward compatible, the upgrade process is straightforward, and dashboards and graphs will not change.</p>
<p>In addition to common tasks you should complete for all versions of Grafana, there might be additional upgrade tasks to complete for a version.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>There might be breaking changes in some releases. We outline all these changes in the 
    <a href="/docs/grafana/latest/whatsnew/">What&rsquo;s New</a> document.</p></blockquote></div>

<p>For versions of Grafana prior to v9.2, we published additional information in the 
    <a href="/docs/grafana/latest/release-notes/">Release Notes</a>.</p>
<p>When available, we list all changes with links to pull requests or issues in the <a href="https://github.com/grafana/grafana/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer">Changelog</a>.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>When possible, we recommend that you test the Grafana upgrade process in a test or development environment.</p></blockquote></div>

</div>

        


<div data-shared="back-up/back-up-grafana.md">
            

<h2 id="back-up-grafana">Back up Grafana</h2>
<p>This topic explains how to back up a local Grafana deployment, including configuration, plugin data, and the Grafana database.</p>
<h3 id="back-up-the-grafana-configuration-file">Back up the Grafana configuration file</h3>
<p>Copy Grafana configuration files that you might have modified in your Grafana deployment to a backup directory.</p>
<p>The Grafana configuration files are located in the following directories:</p>
<ul>
<li>Default configuration: <code>$WORKING_DIR/defaults.ini</code> (Don&rsquo;t change this file)</li>
<li>Custom configuration: <code>$WORKING_DIR/custom.ini</code></li>
</ul>
<p>For more information on where to find configuration files, refer to 
    <a href="/docs/grafana/latest/setup-grafana/configure-grafana/#configuration-file-location">Configuration file location</a>.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If you installed Grafana using the <code>deb</code> or <code>rpm</code> packages, then your configuration file is located at
<code>/etc/grafana/grafana.ini</code>. This path is specified in the Grafana <code>init.d</code> script using <code>--config</code> file parameter.</p></blockquote></div>

<h3 id="back-up-plugin-data">Back up plugin data</h3>
<p>Installing plugins in Grafana creates a folder for each plugin with its associated files and data. Copy all files and folders recursively from this location to your backup repository.</p>
<p>The Grafana plugin files are located in the following directories:</p>
<ul>
<li>Default location for plugins in a binary or source installation: <code>$WORKING_DIR/data/plugins</code></li>
<li>Default location for plugins in a <code>deb</code> or <code>rpm</code> package: <code>/var/lib/grafana/plugins</code>. This path is specified in the Grafana init.d script using <code>--config</code> file parameter.</li>
</ul>
<h3 id="back-up-the-grafana-database">Back up the Grafana database</h3>
<p>We recommend that you back up your Grafana database so that you can roll back to a previous version, if required.</p>
<h4 id="sqlite">SQLite</h4>
<p>The default Grafana database is SQLite, which stores its data in a single file on disk. To back up this file, copy it to your backup repository.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>To ensure data integrity, shut down your Grafana service before backing up the SQLite database.</p></blockquote></div>

<p>The SQLite database file is located in one of the following directories:</p>
<ul>
<li>Default location for SQLite data in a binary or source installation: <code>$WORKING_DIR/data/grafana.db</code></li>
<li>Default location for SQLite data in a <code>deb</code> or <code>rpm</code> package: <code>/var/lib/grafana/grafana.db</code>. This path is specified in the Grafana
init.d script using <code>--config</code> file parameter.</li>
</ul>
<h4 id="mysql">MySQL</h4>
<p>To back up or restore a MySQL Grafana database, run the following commands:</p>
<pre>backup:
&gt; mysqldump -u root -p[root_password] [grafana] &gt; grafana_backup.sql

restore:
&gt; mysql -u root -p grafana &lt; grafana_backup.sql</pre>
<h4 id="postgres">Postgres</h4>
<p>To back up or restore a Postgres Grafana database, run the following commands:</p>
<pre>backup:
&gt; pg_dump grafana &gt; grafana_backup

restore:
&gt; psql grafana &lt; grafana_backup</pre>

  </div>

        


<div data-shared="upgrade/upgrade-common-tasks.md">
            <h2 id="upgrade-grafana">Upgrade Grafana</h2>
<p>The following sections provide instructions for how to upgrade Grafana based on your installation method. For more information on where to find configuration files, refer to 
    <a href="/docs/grafana/latest/setup-grafana/configure-grafana/#configuration-file-location">Configuration file location</a>.</p>
<h3 id="debian">Debian</h3>
<p>To upgrade Grafana installed from a Debian package (<code>.deb</code>), complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to a file named <code>&lt;grafana_install_dir&gt;/grafana.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p><a href="/grafana/download?platform=linux">Download</a> the latest version of Grafana.</p>
</li>
<li>
<p>Run the following <code>dpkg -i</code> command.</p>
<pre>wget &lt;debian package url&gt;
sudo apt-get install -y adduser
sudo dpkg -i grafana_&lt;version&gt;_amd64.deb</pre>
</li>
</ol>
<h3 id="apt-repository">APT repository</h3>
<p>To upgrade Grafana installed from the Grafana Labs APT repository, complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to a file named <code>&lt;grafana_install_dir&gt;/grafana.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p>Run the following commands:</p>
<pre>sudo apt-get update
sudo apt-get upgrade</pre>
</li>
</ol>
<p>Grafana automatically updates when you run <code>apt-get upgrade</code>.</p>
<h3 id="binary-tar-file">Binary .tar file</h3>
<p>To upgrade Grafana installed from the binary <code>.tar.gz</code> package, complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to the custom configuration file, <code>custom.ini</code> or <code>grafana.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p><a href="/grafana/download">Download</a> the binary <code>.tar.gz</code> package.</p>
</li>
<li>
<p>Extract the downloaded package and overwrite the existing files.</p>
</li>
</ol>
<h3 id="rpm-or-yum">RPM or YUM</h3>
<p>To upgrade Grafana installed using RPM or YUM complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to a file named <code>&lt;grafana_install_dir&gt;/grafana.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p>Perform one of the following steps based on your installation.</p>
<ul>
<li>
<p>If you <a href="/grafana/download">downloaded an RPM package</a> to install Grafana, then complete the steps documented in 
    <a href="/docs/grafana/latest/setup-grafana/installation/redhat-rhel-fedora/">Install Grafana on Red Hat, RHEL, or Fedora</a> or 
    <a href="/docs/grafana/latest//setup-grafana/installation/suse-opensuse/">Install Grafana on SUSE or openSUSE</a> to upgrade Grafana.</p>
</li>
<li>
<p>If you used the Grafana YUM repository, run the following command:</p>
<pre>sudo yum update grafana</pre>
</li>
<li>
<p>If you installed Grafana on openSUSE or SUSE, run the following command:</p>
<pre>sudo zypper update</pre>
</li>
</ul>
</li>
</ol>
<h3 id="docker">Docker</h3>
<p>To upgrade Grafana running in a Docker container, complete the following steps:</p>
<ol>
<li>
<p>Use Grafana 
    <a href="/docs/grafana/latest/setup-grafana/configure-grafana/#override-configuration-with-environment-variables">environment variables</a> to save your custom configurations; this is the recommended method. Alternatively, you can view your configuration files manually by accessing the deployed container.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p>Run a commands similar to the following commands.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>This is an example. The parameters you enter depend on how you configured your Grafana container.</p></blockquote></div>

<pre>docker pull grafana/grafana
docker stop my-grafana-container
docker rm my-grafana-container
docker run -d --name=my-grafana-container --restart=always -v /var/lib/grafana:/var/lib/grafana grafana/grafana</pre>
</li>
</ol>
<h3 id="windows">Windows</h3>
<p>To upgrade Grafana installed on Windows, complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to a file named <code>&lt;grafana_install_dir&gt;/conf/custom.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p><a href="/grafana/download">Download</a> the Windows binary package.</p>
</li>
<li>
<p>Extract the contents of the package to the location in which you installed Grafana.</p>
<p>You can overwrite existing files and folders, when prompted.</p>
</li>
</ol>
<h3 id="mac">Mac</h3>
<p>To upgrade Grafana installed on Mac, complete the following steps:</p>
<ol>
<li>
<p>In your current installation of Grafana, save your custom configuration changes to the custom configuration file, <code>custom.ini</code>.</p>
<p>This enables you to upgrade Grafana without the risk of losing your configuration changes.</p>
</li>
<li>
<p><a href="/grafana/download">Download</a> the Mac binary package.</p>
</li>
<li>
<p>Extract the contents of the package to the location in which you installed Grafana.</p>
<p>You can overwrite existing files and folders, when prompted.</p>
</li>
</ol>
<h2 id="update-grafana-plugins">Update Grafana plugins</h2>
<p>After you upgrade Grafana, we recommend that you update all plugins because a new version of Grafana
can make older plugins stop working properly.</p>
<p>Run the following command to update plugins:</p>
<pre>grafana cli plugins update-all</pre>
</div>

        
<h2 id="technical-notes">Technical notes</h2>
<h3 id="grafana-data-source-uid-format-enforcement">Grafana data source UID format enforcement</h3>
<p><strong>Ensure that your data source UIDs follow the correct standard</strong></p>
<p>We&rsquo;ve had standard ways to define UIDs for Grafana objects for years (at least <a href="https://github.com/grafana/grafana/issues/7883" target="_blank" rel="noopener noreferrer">since Grafana v5</a>). While all of our internal code complies with this format, we haven&rsquo;t strictly enforced this format in REST APIs and provisioning paths that allow the creation and update of data sources.</p>
<p>In Grafana v11.1, we <a href="https://github.com/grafana/grafana/pull/86598" target="_blank" rel="noopener noreferrer">introduced</a> a warning that is sent to Grafana server logs every time a data source instance is created or updated using an invalid UID format.</p>
<p>In Grafana v11.2, we <a href="https://github.com/grafana/grafana/pull/89363/files" target="_blank" rel="noopener noreferrer">added</a> a new feature flag called <code>failWrongDSUID</code> that is turned off by default. When enabled, the REST APIs and provisioning reject any requests to create or update data source instances that have an incorrect UID.</p>
<p>In Grafana v12.0, we&rsquo;re turning the feature flag <code>failWrongDSUID</code> on by default.</p>
<h4 id="correct-uid-format">Correct UID format</h4>
<p>You can find the exact regex definition <a href="https://github.com/grafana/grafana/blob/c92f5169d1c83508beb777f71a93336179fe426e/pkg/util/shortid_generator.go#L32-L45" target="_blank" rel="noopener noreferrer">in the <code>grafana/grafana</code> repository</a>.</p>
<p>A data source UID can only contain:</p>
<ul>
<li>Latin characters (<code>a-Z</code>)</li>
<li>Numbers (<code>0-9</code>)</li>
<li>Dash symbols (<code>-</code>)</li>
</ul>
<h4 id="how-do-i-know-if-im-affected">How do I know if I&rsquo;m affected?</h4>
<ul>
<li>You can fetch all your data sources using the <code>/api/datasources</code> API. Review the <code>uid</code> fields, comparing them to the correct format, as shown <a href="/docs/grafana/latest/developers/http_api/data_source/#get-all-data-sources">in the docs</a>. The following script can help, but note that it&rsquo;s missing authentication that you <a href="/docs/grafana/latest/developers/http_api/#authenticating-api-requests">have to add yourself</a>:</li>
</ul>
<pre>curl http://localhost:3000/api/datasources | jq &#39;.[] | select((.uid | test(&#34;^[a-zA-Z0-9\\-_]+$&#34;) | not) or (.uid | length &gt; 40)) | {id, uid, name, type}&#39;</pre>
<ul>
<li>Alternatively, you can check the server logs for the <code>Invalid datasource uid</code> <a href="https://github.com/grafana/grafana/blob/68751ed3107c4d15d33f34b15183ee276611785c/pkg/services/datasources/service/store.go#L429" target="_blank" rel="noopener noreferrer">error</a>.</li>
</ul>
<h4 id="what-do-i-do-if-im-affected">What do I do if I&rsquo;m affected?</h4>
<p>You&rsquo;ll need to create a new data source with the correct UID and update your dashboards and alert rules to use it.</p>
<h4 id="how-do-i-update-my-dashboards-to-use-the-new-or-updated-data-source">How do I update my dashboards to use the new or updated data source?</h4>
<ul>
<li>Go to the dashboard using the data source and update it by selecting the new or updated data source from the picker below your panel.</li>
</ul>
<p>OR</p>
<ul>
<li>
<p>Update the dashboard&rsquo;s JSON model directly using search and replace.</p>
<p>Navigate to <a href="/docs/grafana/latest/dashboards/build-dashboards/view-dashboard-json-model/">dashboard json model</a> and carefully replace all the instances of the old <code>uid</code> with the newly created <code>uid</code>.</p>
<figure
      class="figure-wrapper figure-wrapper__lightbox w-100p "
      style="max-width: 2970px;"
      itemprop="associatedMedia"
      itemscope=""
      itemtype="http://schema.org/ImageObject"
    ><a
          class="lightbox-link"
          href="/media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png"
          itemprop="contentUrl"
        ><div class="img-wrapper w-100p h-auto"><img
            class="lazyload "
            data-src="/media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png"data-srcset="/media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=320 320w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=550 550w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=750 750w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=900 900w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=1040 1040w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=1240 1240w, /media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png?w=1920 1920w"
            data-sizes="auto"alt="Updating JSON Model of a Dashboard"width="2970"height="628"/>
          <noscript>
            <img
              src="/media/docs/grafana/screenshot-grafana-11-datasource-uid-enforcement.png"
              alt="Updating JSON Model of a Dashboard"width="2970"height="628"/>
          </noscript></div></a></figure>
</li>
</ul>
<h4 id="how-do-i-update-my-alert-rules-to-use-the-new-or-updated-data-source">How do I update my alert rules to use the new or updated data source?</h4>
<p>Open the alert rule you want to adjust and search for the data source that is being used for the query/alert condition. From there, select the new data source from the drop-down list and save the alert rule.</p>
<h3 id="enforcing-stricter-version-compatibility-checks-in-plugin-cli-install-commands">Enforcing stricter version compatibility checks in plugin CLI install commands</h3>
<p>Since Grafana 10.2, the endpoint to check compatible versions when installing a plugin using <code>grafana cli plugins install</code> changed, which led to Grafana dependency version no longer being taken into account. This might have led to some behavior where the CLI would install plugins that are not fully compatible based on the plugins definition of compatibility via <code>grafanaDependency</code> property in the <code>plugin.json</code> file.</p>
<h4 id="what-if-i-want-to-ignore-the-compatibility-check">What if I want to ignore the compatibility check?</h4>
<p>We <em>do not</em> recommend installing plugins declared as incompatible. However, if you need to force install a plugin despite it being declared as incompatible, refer to the <a href="/docs/grafana/latest/administration/plugin-management/#install-a-plugin-from-a-zip-file">Installing a plugin from a ZIP</a> guidance.</p>
