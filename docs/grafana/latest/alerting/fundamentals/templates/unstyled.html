<!DOCTYPE html>
<h1 id="templates">Templates</h1>
<p>Use templating to customize, format, and reuse alert notification messages. Create more flexible and informative alert notification messages by incorporating dynamic content, such as metric values, labels, and other contextual information.</p>
<p>In Grafana, you have various options to template your alert notification messages:</p>
<ol>
<li>
<p><a href="#template-annotations">Alert rule annotations</a></p>
<ul>
<li>Annotations add extra information, like <code>summary</code> and <code>description</code>, to alert instances for notification messages.</li>
<li>Template annotations to display query values that are meaningful to the alert, for example, the server name or the threshold query value.</li>
</ul>
</li>
<li>
<p><a href="#template-labels">Alert rule labels</a></p>
<ul>
<li>Labels are used to differentiate an alert instance from all other alert instances.</li>
<li>Template labels to add an additional label based on a query value, or when the labels from the query are incomplete or not descriptive enough.</li>
<li>Avoid displaying query values in labels as this can create numerous alert instances—use annotations instead.</li>
</ul>
</li>
<li>
<p><a href="#template-notifications">Notification templates</a></p>
<ul>
<li>Notification templates are used by contact points for consistent messaging in notification titles and descriptions.</li>
<li>Template notifications when you want to customize the appearance and information of your notifications.</li>
<li>Avoid using notification templates to add extra information to alert instances—use annotations instead.</li>
</ul>
</li>
</ol>


<div class="admonition admonition-tip"><blockquote><p class="title text-uppercase">Tip</p><p>For a practical example of templating, refer to our <a href="/tutorials/alerting-get-started-pt4/">Getting Started with Templating tutorial</a>.</p></blockquote></div>

<p>This diagram illustrates the entire templating process, from querying labels and templating the alert summary and notification to the final alert notification message.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 1200px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link captioned"
        href="/media/docs/alerting/how-notification-templates-works.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload mb-0"
          data-src="/media/docs/alerting/how-notification-templates-works.png"data-srcset="/media/docs/alerting/how-notification-templates-works.png?w=320 320w, /media/docs/alerting/how-notification-templates-works.png?w=550 550w, /media/docs/alerting/how-notification-templates-works.png?w=750 750w, /media/docs/alerting/how-notification-templates-works.png?w=900 900w, /media/docs/alerting/how-notification-templates-works.png?w=1040 1040w, /media/docs/alerting/how-notification-templates-works.png?w=1240 1240w, /media/docs/alerting/how-notification-templates-works.png?w=1920 1920w"
          data-sizes="auto"alt="How templating works"width="1072"height="699"title="How templating works"/>
        <noscript>
          <img
            src="/media/docs/alerting/how-notification-templates-works.png"
            alt="How templating works"width="1072"height="699"title="How templating works"/>
        </noscript></div><figcaption class="w-100p caption text-gray-13  ">How templating works</figcaption></a></figure>
<p>In this diagram:</p>
<ol>
<li>The alert rule query returns <code>12345</code>, along with the values of the <code>instance</code> and <code>job</code> labels.</li>
<li>This query result breaches the alert rule condition, firing the alert instance.</li>
<li>The alert instance generates an annotation summary, defined by the template used in the alert rule summary. In this case, it displays the value of the <code>instance</code> label: <code>server1</code>.</li>
<li>The Alertmanager receives the firing alert instance, including the final annotation summary, and determines the contact point that will process the alert.</li>
<li>The Alertmanager uses the contact point&rsquo;s notification template to format the message, then sends the notification to the configured destination(s)—an email address.</li>
</ol>
<h2 id="template-annotations">Template annotations</h2>
<p>
    <a href="/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#annotations">Annotations</a> can be defined in the alert rule to add extra information to alert instances.</p>
<p>When creating an alert rule, Grafana suggests several optional annotations, such as <code>description</code>, <code>summary</code>, and <code>runbook_url</code>, which help identify and respond to alerts. You can also create custom annotations.</p>
<p>Annotations are key-value pairs, and their values can contain a combination of text and template code that is evaluated when the alert fires.</p>
<p>Annotations can contain plain text, but you should template annotations if you need to display query values that are relevant to the alert, for example:</p>
<ul>
<li>Show the query value that triggers the alert.</li>
<li>Include labels returned by the query that identify the alert.</li>
<li>Format the annotation message depending on a query value.</li>
</ul>
<p>Here’s an example of templating an annotation, which explains where and why the alert was triggered. In this case, the alert triggers when CPU usage exceeds a threshold, and the <code>summary</code> annotation provides the relevant details.</p>
<pre>CPU usage for {{ $labels.instance }} has exceeded 80% ({{ $values.A.Value }}) for the last 5 minutes.</pre>
<p>The outcome of this template would be:</p>
<pre>CPU usage for Instance 1 has exceeded 80% (81.2345) for the last 5 minutes.</pre>
<p>Implement annotations that provide meaningful information to respond to your alerts. Annotations are displayed in the Grafana alert detail view and are included by default in notifications.</p>
<p>For more details on how to template annotations, refer to 
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/">Template annotations and labels</a>.</p>
<h2 id="template-labels">Template labels</h2>
<p>
    <a href="/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#labels">Labels</a> are used to differentiate one alert instance from all other alert instances, as the set of labels uniquely identifies an alert instance. Notification policies and silences use labels to handle alert instances.</p>
<p>You can also template labels based on query results. This is helpful if the labels you get from your query aren&rsquo;t detailed enough. For instance:</p>
<ul>
<li>Add a new label to change how alerts are identified and grouped into different alert groups.</li>
<li>Add a new label used by notification policies or silences to manage how the alert is handled.</li>
</ul>
<p>Here’s an example of templating a new <code>env</code> label based on the value of a query label:</p>
<pre>{{- if eq $labels.instance &#34;prod-server-1&#34; -}}
production
{{- else if eq $labels.instance &#34;staging-server-1&#34; -}}
staging
{{- else -}}
development
{{- end -}}</pre>
<p>For more details on how to template labels, refer to 
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/">Template annotations and labels</a>.</p>
<h2 id="template-notifications">Template notifications</h2>
<p>
    <a href="/docs/grafana/latest/alerting/configure-notifications/template-notifications/">Notification templates</a> allow you to customize the content of your notifications, such as the subject of an email or the body of a Slack message.</p>
<p>Notification templates differ from templating annotations and labels in the following ways:</p>
<ul>
<li>Notification templates are assigned to the <strong>Contact point</strong>, rather than the alert rule.</li>
<li>If not specified, the contact point uses a default template that includes relevant alert information.</li>
<li>The same template can be shared across multiple contact points, making it easier to maintain and ensuring consistency.</li>
<li>Notification templates should not be used to add additional information to individual alerts—use annotations for that purpose.</li>
<li>While both annotation/label templates and notification templates use the same templating language, the available variables and functions differ. For more details, refer to the 
    <a href="/docs/grafana/latest/alerting/configure-notifications/template-notifications/reference/">notification template reference</a> and 
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/">annotation/label template reference</a>.</li>
</ul>
<p>Here is an example of a notification template that summarizes all firing and resolved alerts in a notification group:</p>
<pre>{{ define &#34;alerts.message&#34; -}}
  {{ if .Alerts.Firing -}}
    {{ len .Alerts.Firing }} firing alert(s)
    {{ template &#34;alerts.summarize&#34; .Alerts.Firing }}
  {{- end }}
  {{- if .Alerts.Resolved -}}
    {{ len .Alerts.Resolved }} resolved alert(s)
    {{ template &#34;alerts.summarize&#34; .Alerts.Resolved }}
  {{- end }}
{{- end }}

{{ define &#34;alerts.summarize&#34; -}}
  {{ range . -}}
  - {{ index .Annotations &#34;summary&#34; }}
  {{ end }}
{{ end }}</pre>
<p>The notification message to the contact point would look like this:</p>
<pre>1 firing alert(s)
- The database server db1 has exceeded 75% of available disk space. Disk space used is 76%, please resize the disk size within the next 24 hours.

1 resolved alert(s)
- The web server web1 has been responding to 5% of HTTP requests with 5xx errors for the last 5 minutes.</pre>
<p>For more details, refer to 
    <a href="/docs/grafana/latest/alerting/configure-notifications/template-notifications/">Template notifications</a>.</p>
