<!DOCTYPE html>
<h1 id="template-annotations-and-labels">Template annotations and labels</h1>
<p>You can use templates to customize alert and notification messages, including dynamic data from alert rule queries.</p>
<p>In Grafana Alerting, you can template alert messages in two ways.</p>
<ol>
<li><strong>Template annotations and labels</strong>: In the alert rule definition, you can template annotations and labels to include extra information from query data to the alert, adding meaningful details based on the query results.</li>
<li><strong>Template notifications</strong>: You can template notifications to control the content and appearance of your notifications.</li>
</ol>
<h2 id="how-templating-works">How templating works</h2>
<p>In this diagram, you can see the differences between both types of templates.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 1200px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/media/docs/alerting/how-notification-templates-works.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/media/docs/alerting/how-notification-templates-works.png"data-srcset="/media/docs/alerting/how-notification-templates-works.png?w=320 320w, /media/docs/alerting/how-notification-templates-works.png?w=550 550w, /media/docs/alerting/how-notification-templates-works.png?w=750 750w, /media/docs/alerting/how-notification-templates-works.png?w=900 900w, /media/docs/alerting/how-notification-templates-works.png?w=1040 1040w, /media/docs/alerting/how-notification-templates-works.png?w=1240 1240w, /media/docs/alerting/how-notification-templates-works.png?w=1920 1920w"
          data-sizes="auto"alt="How templating works"width="1072"height="699"/>
        <noscript>
          <img
            src="/media/docs/alerting/how-notification-templates-works.png"
            alt="How templating works"width="1072"height="699"/>
        </noscript></div></a></figure>
<p>Refer to 
    <a href="/docs/grafana/latest/alerting/fundamentals/templates/">Templates Introduction</a> for a more detailed explanation of this diagram.</p>
<p>Both types of templates are written in the Go templating system. However, it&rsquo;s important to understand that variables and functions used in notification templates are different from those used in annotation and label templates.</p>
<ol>
<li><strong>Template annotations and labels</strong>: These templates add extra information to individual alert instances. Template variables like 
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/reference/#labels"><code>$labels</code></a> and 
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/reference/#values"><code>$values</code></a> represent alert query data of the individual alert instance.</li>
<li><strong>Template notifications</strong>: Notification templates format the notification content for a group of alerts. Variables like 
    <a href="/docs/grafana/latest/alerting/configure-notifications/template-notifications/reference/#notification-data"><code>.Alerts</code></a> include all firing and resolved alerts in the notification.</li>
</ol>
<h2 id="template-annotations">Template annotations</h2>
<p>
    <a href="/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#annotations">Annotations</a> add additional information to alert instances and are often used to help identify the alert and guide responders on how to address the issue.</p>
<p>Annotations are key-value pairs defined in the alert rule. They can contain plain text or template code that is evaluated when the alert fires.</p>
<p>Grafana includes several optional annotations, such as <code>description</code>, <code>summary</code>, and <code>runbook_url</code>, which can be edited in the alert rule. You can also create your custom annotations. For example, you might create a new annotation named <code>location</code> to report the location of the system that triggered the alert.</p>
<p>Here’s an example of a <code>summary</code> annotation explaining why the alert was triggered, using plain text.</p>
<pre>CPU usage has exceeded 80% for the last 5 minutes.</pre>
<p>However, if you want to display dynamic query values in annotations, you need to use template code. Common use cases include:</p>
<ul>
<li>Displaying the query value that triggered the alert.</li>
<li>Highlighting label information that identifies the alert, such as the environment, instance, or region.</li>
<li>Providing specific instructions based on query values.</li>
<li>Customizing runbook links depending on query labels.</li>
<li>Including contact information based on query labels.</li>
</ul>
<p>For instance, you can template the previous example to display the specific instance and CPU value that triggered the alert.</p>
<pre>CPU usage for {{ $labels.instance }} has exceeded 80% ({{ $values.A.Value }}) for the last 5 minutes.</pre>
<p>Alternatively, you can use the <code>index</code> function to print query values.</p>
<pre>CPU usage for {{ index $labels &#34;instance&#34; }} has exceeded 80% ({{ index $values &#34;A&#34; }}) for the last 5 minutes.</pre>
<p>The result of the annotation would be as follows.</p>
<pre>CPU usage for Instance 1 has exceeded 80% (81.2345) for the last 5 minutes.</pre>
<h3 id="how-to-template-an-annotation">How to template an annotation</h3>
<p>Complete the following steps to template an annotation.</p>
<ol>
<li>Navigate to <strong>Alerts &amp; IRM</strong> -&gt; <strong>Alert rules</strong> -&gt; create or edit an alert rule.</li>
<li>Scroll down to the <strong>Configure notification message</strong> section.</li>
<li>Copy in your template in the corresponding annotation field (<code>summary</code>, <code>description</code>, <code>runbook_url</code>, <code>custom</code>).</li>
</ol>
<h3 id="preview-annotation-templates">Preview annotation templates</h3>
<p>You can template annotations when creating or editing an alert rule.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 1200px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/media/docs/alerting/alert-rule-using-annotation-template.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/media/docs/alerting/alert-rule-using-annotation-template.png"data-srcset="/media/docs/alerting/alert-rule-using-annotation-template.png?w=320 320w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=550 550w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=750 750w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=900 900w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=1040 1040w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=1240 1240w, /media/docs/alerting/alert-rule-using-annotation-template.png?w=1920 1920w"
          data-sizes="auto"alt="An alert rule templating the annotation summary"width="900"height="498"/>
        <noscript>
          <img
            src="/media/docs/alerting/alert-rule-using-annotation-template.png"
            alt="An alert rule templating the annotation summary"width="900"height="498"/>
        </noscript></div></a></figure>
<p>Two common methods are used to test and preview annotation templates:</p>
<ol>
<li>Trigger the alert and 
    <a href="/docs/grafana/latest/alerting/monitor-status/view-alert-state/">view the alert instance state in the Grafana UI</a>, where all annotations of the alert instance are displayed.</li>
<li>Use a notification template that displays all annotations, then 
    <a href="/docs/grafana/latest/alerting/configure-notifications/template-notifications/manage-notification-templates/#preview-notification-templates">preview the notification template</a> using the alert instance.</li>
</ol>
<h2 id="template-labels">Template labels</h2>
<p>The set of 
    <a href="/docs/grafana/latest/latest/alerting/fundamentals/alert-rules/annotation-label/">labels</a> for an alert instance is used to uniquely identify that alert among all other alert instances.</p>
<p>Labels determine how alerts are routed and managed for notifications, making their design key to the effectiveness of your alerting system.</p>
<p>Labels can be returned from an alert rule query, such as the <code>pod</code> label in a Kubernetes Prometheus query. You can also define additional labels in the alert rule to provide extra information for processing alerts.</p>
<p>Like annotations, labels are key-value pairs that can contain plain text or template code evaluated when the alert fires.</p>
<p>Template labels when the labels returned by your queries are insufficient. For instance:</p>
<ul>
<li>A new label based on a query value can group a subset of alerts differently, changing how notifications are sent.</li>
<li>A new label based on a query value can be used in a notification policy to alter the notification contact point.</li>
</ul>
<p>Here’s an example of templating a <code>severity</code> label based on the query value.</p>
<pre>{{ if (gt $values.A.Value 90.0) -}}
critical
{{ else if (gt $values.A.Value 80.0) -}}
high
{{ else if (gt $values.A.Value 60.0) -}}
medium
{{ else -}}
low
{{- end }}</pre>
<p>In this example, the value of the <code>severity</code> label is determined by the query value, and the possible options are <code>critical</code>, <code>high</code>, <code>medium</code>, or <code>low</code>. You can then use the <code>severity</code> label to change their notifications—for instance, sending <code>critical</code> alerts immediately or routing <code>low</code> alerts to a specific team for further review.</p>
<blockquote>
<p><strong>Note:</strong> An alert instance is uniquely identified by its set of labels.</p>
<ul>
<li>Avoid displaying query values in labels, as this can create numerous alert instances—one for each distinct label set. Instead, use annotations for query values.</li>
<li>If a templated label&rsquo;s value changes, it maps to a different alert instance, and the previous instance is considered <strong>stale</strong>. Learn all the details in this 
    <a href="/docs/grafana/latest/alerting/best-practices/dynamic-labels/">example using dynamic labels</a>.</li>
</ul></blockquote>
<h3 id="how-to-template-a-label">How to template a label</h3>
<p>Complete the following steps to template a label.</p>
<ol>
<li>Navigate to <strong>Alerts &amp; IRM</strong> -&gt; <strong>Alert rules</strong> -&gt; create or edit an alert rule.</li>
<li>Scroll down to the <strong>Configure labels and notifications</strong> section.</li>
<li>Click <strong>+ Add labels</strong>.</li>
<li>Enter a <strong>key</strong> that identifies the label.</li>
<li>Copy in your template in the <strong>value</strong> field.</li>
</ol>
<h3 id="preview-label-templates">Preview label templates</h3>
<p>You can template label values when creating or editing an alert rule.</p>
<p>To preview label values, select <code>Use notification policy</code>, and then click on <code>Preview routing</code>.</p>
<figure
    class="figure-wrapper figure-wrapper__lightbox w-100p "
    style="max-width: 1200px;"
    itemprop="associatedMedia"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
  ><a
        class="lightbox-link"
        href="/media/docs/alerting/alert-instance-routing-preview.png"
        itemprop="contentUrl"
      ><div class="img-wrapper w-100p h-auto"><img
          class="lazyload "
          data-src="/media/docs/alerting/alert-instance-routing-preview.png"data-srcset="/media/docs/alerting/alert-instance-routing-preview.png?w=320 320w, /media/docs/alerting/alert-instance-routing-preview.png?w=550 550w, /media/docs/alerting/alert-instance-routing-preview.png?w=750 750w, /media/docs/alerting/alert-instance-routing-preview.png?w=900 900w, /media/docs/alerting/alert-instance-routing-preview.png?w=1040 1040w, /media/docs/alerting/alert-instance-routing-preview.png?w=1240 1240w, /media/docs/alerting/alert-instance-routing-preview.png?w=1920 1920w"
          data-sizes="auto"alt="Routing preview displays label values"width="2614"height="1040"/>
        <noscript>
          <img
            src="/media/docs/alerting/alert-instance-routing-preview.png"
            alt="Routing preview displays label values"width="2614"height="1040"/>
        </noscript></div></a></figure>
<h2 id="more-information">More information</h2>
<p>For further details on how to template alert rules, refer to:</p>
<ul>
<li>
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/reference/">Annotation and label template reference</a></li>
<li>
    <a href="/docs/grafana/latest/alerting/alerting-rules/templates/examples/">Annotation and label examples</a></li>
</ul>


<div class="admonition admonition-tip"><blockquote><p class="title text-uppercase">Tip</p><p>For a practical example of templating, refer to our <a href="/tutorials/alerting-get-started-pt4/">Getting Started with Templating tutorial</a>.</p></blockquote></div>

