<!DOCTYPE html>
<h1 id="create-grafana-managed-recording-rules">Create Grafana-managed recording rules</h1>
<p>
    <a href="/docs/grafana/latest/alerting/alerting-rules/create-recording-rules/">Recording rules</a> allow you to periodically pre-compute frequently used or computationally expensive queries, saving the results as a new time series metric.</p>
<p>Alert rules and dashboards can then query the new metric resulting from the recording rule. This is faster than querying real-time data and can help to reduce system load.</p>
<p>Grafana does not contain an embedded time-series database to store recording rule results. You must bring your own Prometheus-compatible database to store the series generated by recording rules.</p>
<p>Grafana-managed recording rules offer the same Prometheus-like semantics but allow you to query 
    <a href="/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#supported-data-sources">data sources supported by alerting</a>. Additionally, you can use recording rules to import and map data from other data sources into Prometheus.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Grafana-managed recording rules are enabled by default in Grafana Cloud.</p>
<p>In Grafana OSS and Enterprise, you must enable them by following the <a href="#before-you-begin">Before you begin</a> instructions.</p></blockquote></div>

<p>To configure Grafana-managed recording rules, complete the following steps.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>This section only applies to Grafana OSS and Grafana Enterprise.</p>
<p>If a rule does not explicitly specify a target data source for writing (for example, if it was created before Grafana 12.1), Grafana will fall back to the <code>default_datasource_uid</code> set in the configuration:</p>
<pre>[recording_rules]
default_datasource_uid = my-uid</pre>
<p>If you previously configured recording rules using the <code>url</code> and <code>basic_auth_*</code> configuration options, these are no longer supported. You must either:</p>
<ul>
<li>Set <code>default_datasource_uid</code> in the <code>[recording_rules]</code> section of the configuration file to point to the target data source</li>
<li>Or, before upgrading to Grafana 12.1, enable the <code>grafanaManagedRecordingRulesDatasources</code> feature flag and update each recording rule individually to include a target data source</li>
</ul>
<h2 id="add-new-recording-rule">Add new recording rule</h2>
<p>To create a new Grafana-managed recording rule:</p>
<ol>
<li>
<p>Click <strong>Alerts &amp; IRM</strong> -&gt; <strong>Alerting</strong> -&gt;
<strong>Alert rules</strong>.</p>
</li>
<li>
<p>At the top of the Alert rules page, click <strong>More</strong> -&gt; <strong>New Grafana recording rule</strong>.</p>
</li>
<li>
<p>Enter the names to identify your recording rule and metric.</p>
<p>The metric name must be a Prometheus metric name and contain no whitespace. For details, refer to <a href="https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels" target="_blank" rel="noopener noreferrer">Prometheus metric names</a>.</p>
</li>
</ol>
<h2 id="define-recording-rule">Define recording rule</h2>
<p>Define a query to get the data you want to measure and set the recording rule output.</p>
<ol>
<li>
<p>Select a data source.</p>
</li>
<li>
<p>From the <strong>Options</strong> dropdown, specify a time range.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Grafana Alerting only supports fixed relative time ranges, for example, <code>now-24hr: now</code>.</p>
<p>It does not support absolute time ranges: <code>2021-12-02 00:00:00 to 2021-12-05 23:59:592</code> or semi-relative time ranges: <code>now/d to: now</code>.</p></blockquote></div>

</li>
<li>
<p>Add a query.</p>
<p>To add multiple queries, click <strong>Add query</strong>.</p>
</li>
<li>
<p>Add one or more 
    <a href="/docs/grafana/latest/alerting/fundamentals/alert-rules/queries-conditions/#expression-queries">expressions</a>.</p>
<p>a. For each expression, select either <strong>Classic condition</strong> to create a single recording rule, or choose from the <strong>Math</strong>, <strong>Reduce</strong>, and <strong>Resample</strong> options.</p>
<p>When using Prometheus, you can use an instant vector and built-in functions, so you don&rsquo;t need to add additional expressions.</p>
<p>b. Click <strong>Preview</strong> to verify that the expression is successful.</p>
</li>
<li>
<p>Click <strong>Set as recording rule output</strong> on the query or expression you want to set as your rule output.</p>
</li>
</ol>
<h2 id="set-evaluation-behavior">Set evaluation behavior</h2>
<p>Use recording rule evaluation to determine how frequently a recording rule should be evaluated.</p>
<p>To do this, you need to make sure that your recording rule is in the right evaluation group with an interval that works best for your use case.</p>
<ol>
<li>
<p>Select a folder or click <strong>+ New folder</strong>.</p>
</li>
<li>
<p>Select an evaluation group or click <strong>+ New evaluation group</strong>.</p>
<p>If you are creating a new evaluation group, specify the interval for the group.</p>
<p>All rules within the same group are evaluated concurrently over the same time interval. Every recording rule in a group uses the same evaluation time, meaning that all queries from the same group are always aligned with each other.</p>
</li>
<li>
<p>Before or after creating a recording rule, you have the option to <strong>Pause evaluation</strong> if necessary.</p>
</li>
</ol>
<h3 id="advanced-configuration">Advanced configuration</h3>
<p>
    <a href="/docs/grafana/latest/setup-grafana/configure-grafana/#min_interval">min_interval</a> sets the minimum interval to enforce between rule evaluations. The default value is 10s which equals the scheduler interval. Rules are adjusted if they are less than this value or if they are not multiple of the scheduler interval (10s). Higher values can help with resource management as fewer evaluations are scheduled over time.</p>
<p>This setting has precedence over each individual rule frequency. If a rule frequency is lower than this value, then this value is enforced.</p>
<p>This setting applies to both Grafana-managed alert and recording rules.</p>
<h2 id="add-labels">Add labels</h2>
<p>Optionally, you can add custom labels to the resulting metric by selecting existing key-value pairs from the drop down or entering the new key or value.</p>
<h2 id="query-the-new-metric-in-dashboards-or-alert-rules">Query the new metric in dashboards or alert rules</h2>
<p>Click <strong>Save rule</strong> or <strong>Save rule and exit</strong> to save the rule.</p>
<p>Once saved, the new recording metric is available for use in dashboards and alert rules.</p>
