<!DOCTYPE html>
<h1 id="create-data-source-managed-recording-rules">Create data source-managed recording rules</h1>
<p>
    <a href="/docs/grafana/latest/alerting/alerting-rules/create-recording-rules/">Recording rules</a> allow you to periodically pre-compute frequently used or computationally expensive queries, saving the results as a new time series metric.</p>
<p>Alert rules and dashboards can then query the new metric resulting from the recording rule. This is faster than querying real-time data and can help to reduce system load.</p>
<p>Data source-managed recording rules can query Prometheus-based data sources like Mimir or Loki. For more information on recording rules in Prometheus, refer to <a href="https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/" target="_blank" rel="noopener noreferrer">Defining recording rules in Prometheus</a>.</p>
<p>Note that in data source-managed groups, the alert rules and recording rules within the same evaluation group are evaluated sequentially. This is useful to ensure that a recording rule is evaluated before any other alert rule queries the pre-computed metric.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li>
<p>Verify that you have write permission to the Prometheus or Loki data source. Otherwise, you will not be able to create or update Grafana Mimir managed alerting rules.</p>
</li>
<li>
<p>For Grafana Mimir and Loki data sources, enable the ruler API by configuring their respective services.</p>
<ul>
<li>
<p><strong>Loki</strong> - The <code>local</code> rule storage type, default for the Loki data source, supports only viewing of rules. To edit rules, configure one of the other rule storage types.</p>
</li>
<li>
<p><strong>Mimir</strong> - use the <code>/prometheus</code> prefix. The Prometheus data source supports both Grafana Mimir and Prometheus, and Grafana expects that both the <a href="/docs/mimir/latest/operators-guide/reference-http-api/#querier--query-frontend">Query API</a> and <a href="/docs/mimir/latest/operators-guide/reference-http-api/#ruler">Ruler API</a> are under the same URL. You cannot provide a separate URL for the Ruler API.</p>
</li>
</ul>
</li>
</ul>
<h2 id="add-new-recording-rule">Add new recording rule</h2>
<p>To create a new data source-managed recording rule:</p>
<ol>
<li>Click <strong>Alerts &amp; IRM</strong> -&gt; <strong>Alerting</strong> -&gt; <strong>Alert rules</strong>.</li>
<li>At the top of the Alert rules page, click <strong>More</strong> -&gt; <strong>New Grafana recording rule</strong>.</li>
</ol>
<h2 id="enter-recording-rule-name">Enter recording rule name</h2>
<p>The recording rule name must be a Prometheus metric name and contain no whitespace.</p>
<h2 id="define-recording-rule">Define recording rule</h2>
<p>Select your data source and enter a query. The queries used in data source-managed recording rules always run as instant queries.</p>
<h2 id="add-namespace-and-group">Add namespace and group</h2>
<ol>
<li>
<p>From the <strong>Namespace</strong> dropdown, select an existing rule namespace or add a new one.</p>
<p>Namespaces can contain one or more rule groups and only have an organizational purpose.</p>
</li>
<li>
<p>From the <strong>Group</strong> dropdown, select an existing group within the selected namespace or add a new one.</p>
<p>Rules within a group are run sequentially at a regular interval, with the same evaluation time.</p>
<p>Newly created rules are appended to the end of the group, and you can reorder them from the <strong>Alert rules</strong> page.</p>
</li>
</ol>
<h2 id="add-labels">Add labels</h2>
<p>Optionally, you can add custom labels to the resulting metric by selecting existing key-value pairs from the drop down or entering the new key or value.</p>
<h2 id="query-the-new-metric-in-dashboards-or-alert-rules">Query the new metric in dashboards or alert rules</h2>
<p>Click <strong>Save rule</strong> or <strong>Save rule and exit</strong> to save the rule.</p>
<p>Once saved, the new recording metric is available for use in dashboards and alert rules.</p>
