<!DOCTYPE html>
<h1 id="configure-grafana-secret-scanning-and-notifications">Configure Grafana secret scanning and notifications</h1>
<p>With Grafana, you can use the GitHub Secret Scanning service to determine if your <a href="../../../administration/service-accounts/">service account tokens</a> have been leaked on GitHub.</p>
<p>When GitHub Secret Scanning detects a Grafana secret, its hash is stored in Grafana Labs&rsquo; secret scanning service.</p>
<p>Grafana instances, whether on-premises or on the cloud, can use this service to verify if a token generated by the instance has been made public. This verification is done by comparing the token&rsquo;s hash with the exposed token&rsquo;s hash.</p>
<p>If the service detects a leaked token, it immediately revokes it, making it useless, and logs the event.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If the <code>revoke</code> option is disabled, the service only sends a notification to the configured webhook URL and logs the event. The token is not automatically revoked.</p></blockquote></div>

<p>You can also configure the service to send an outgoing webhook notification to a webhook URL.</p>
<p>The notification includes a JSON payload that contains the following data:</p>
<pre>{
  &#34;alert_uid&#34;: &#34;c9ce50a1-d66b-45e4-9b5d-175766cfc026&#34;,
  &#34;link_to_upstream_details&#34;: &lt;URL to token leak&gt;,
  &#34;message&#34;: &#34;Token of type grafana_service_account_token with name
sa-the-toucans has been publicly exposed in &lt;URL to token leak&gt;.
Grafana has revoked this token&#34;,
  &#34;state&#34;: &#34;alerting&#34;,
  &#34;title&#34;: &#34;SecretScan Alert: Grafana Token leaked&#34;
}</pre>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Secret scanning is disabled by default. Outgoing connections are made once you enable it.</p></blockquote></div>

<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li>Ensure all your API keys have been migrated to service accounts.
For more information about service account migration, refer to 
    <a href="/docs/grafana/latest/administration/service-accounts/migrate-api-keys/">Migrate API keys to Grafana service accounts</a>.</li>
</ul>
<h2 id="configure-secret-scanning">Configure secret scanning</h2>
<ol>
<li>
<p>Open the Grafana configuration file.</p>
</li>
<li>
<p>In the <code>[secretscan]</code> section, update the following parameters:</p>
</li>
</ol>
<pre>[secretscan]
# Enable secretscan feature
enabled = true

# Whether to revoke the token if a leak is detected or just send a notification
revoke = true</pre>
<p>Save the configuration file and restart Grafana.</p>
<h2 id="configure-outgoing-webhook-notifications">Configure outgoing webhook notifications</h2>
<ol>
<li>
<p>Create an oncall integration of the type <strong>Webhook</strong> and set up alerts.
To learn how to create a Grafana OnCall integration, refer to <a href="/docs/oncall/latest/integrations/webhook/">Inbound Webhook integrations for Grafana OnCall</a>.</p>
</li>
<li>
<p>Copy the webhook URL of the new integration.</p>
</li>
<li>
<p>Open the Grafana configuration file.</p>
</li>
<li>
<p>In the <code>[secretscan]</code> section, update the following parameters,
replacing the URL with the webhook URL you copied in step 2.</p>
</li>
</ol>
<pre>[secretscan]
# URL to send a webhook payload in oncall format
oncall_url = https://example.url/integrations/v1/webhook/3a359nib9eweAd9lAAAETVdOx/</pre>
<p>Save the configuration file and restart Grafana.</p>
