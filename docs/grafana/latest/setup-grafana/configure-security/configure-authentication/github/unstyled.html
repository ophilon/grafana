<!DOCTYPE html>
<h1 id="configure-github-oauth-authentication">Configure GitHub OAuth authentication</h1>


<div data-shared="auth/intro.md">
            <p>There are numerous authentication methods available in Grafana to verify user identity. The authentication configuration dictates which users can access Grafana and the methods they can use for logging in.
You can also configure Grafana to automatically update users&rsquo; roles and team memberships in Grafana based on the information returned by the auth provider integration.</p>
<p>When deciding on an authentication method, it&rsquo;s important to take into account your current identity and access management system as well as the specific authentication and authorization features you require.
For a complete list of the available authentication options and the features they support, refer to 
    <a href="/docs/grafana/latest/setup-grafana/configure-security/configure-authentication/">Configure authentication</a>.</p>
</div>

        
<p>This topic describes how to configure GitHub OAuth authentication.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If Users use the same email address in GitHub that they use with other authentication providers (such as Grafana.com), you need to do additional configuration to ensure that the users are matched correctly. Please refer to the <a href="../#using-the-same-email-address-to-login-with-different-identity-providers">Using the same email address to login with different identity providers</a> documentation for more information.</p></blockquote></div>

<h2 id="before-you-begin">Before you begin</h2>
<p>Ensure you know how to create a GitHub OAuth app. Consult GitHub&rsquo;s documentation on <a href="https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app" target="_blank" rel="noopener noreferrer">creating an OAuth app</a> for more information.</p>
<h3 id="create-a-github-oauth-app">Create a GitHub OAuth App</h3>
<ol>
<li>Log in to your GitHub account.
In <strong>Profile &gt; Settings &gt; Developer settings</strong>, select <strong>OAuth Apps</strong>.</li>
<li>Click <strong>New OAuth App</strong>.</li>
<li>Fill out the fields, using your Grafana homepage URL when appropriate.
In the <strong>Authorization callback URL</strong> field, enter the following: <code>https://&lt;YOUR-GRAFANA-URL&gt;/login/github</code> .</li>
<li>Note your client ID.</li>
<li>Generate, then note, your client secret.</li>
</ol>
<h2 id="configure-github-authentication-client-using-the-grafana-ui">Configure GitHub authentication client using the Grafana UI</h2>
<p>As a Grafana Admin, you can configure GitHub OAuth client from within Grafana using the GitHub UI. To do this, navigate to <strong>Administration &gt; Authentication &gt; GitHub</strong> page and fill in the form. If you have a current configuration in the Grafana configuration file, the form will be pre-populated with those values. Otherwise the form will contain default values.</p>
<p>After you have filled in the form, click <strong>Save</strong>. If the save was successful, Grafana will apply the new configurations.</p>
<p>If you need to reset changes you made in the UI back to the default values, click <strong>Reset</strong>. After you have reset the changes, Grafana will apply the configuration from the Grafana configuration file (if there is any configuration) or the default values.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If you run Grafana in high availability mode, configuration changes may not get applied to all Grafana instances immediately. You may need to wait a few minutes for the configuration to propagate to all Grafana instances.</p></blockquote></div>

<p>Refer to <a href="#configuration-options">configuration options</a> for more information.</p>
<h2 id="configure-github-authentication-client-using-the-terraform-provider">Configure GitHub authentication client using the Terraform provider</h2>
<pre>resource &#34;grafana_sso_settings&#34; &#34;github_sso_settings&#34; {
  provider_name = &#34;github&#34;
  oauth2_settings {
    name                  = &#34;Github&#34;
    client_id             = &#34;YOUR_GITHUB_APP_CLIENT_ID&#34;
    client_secret         = &#34;YOUR_GITHUB_APP_CLIENT_SECRET&#34;
    allow_sign_up         = true
    auto_login            = false
    scopes                = &#34;user:email,read:org&#34;
    team_ids              = &#34;150,300&#34;
    allowed_organizations = &#34;[\&#34;My Organization\&#34;, \&#34;Octocats\&#34;]&#34;
    allowed_domains       = &#34;mycompany.com mycompany.org&#34;
    role_attribute_path   = &#34;[login==&#39;octocat&#39;][0] &amp;&amp; &#39;GrafanaAdmin&#39; || &#39;Viewer&#39;&#34;
  }
}</pre>
<p>Go to <a href="https://registry.terraform.io/providers/grafana/grafana/latest/docs/resources/sso_settings" target="_blank" rel="noopener noreferrer">Terraform Registry</a> for a complete reference on using the <code>grafana_sso_settings</code> resource.</p>
<h2 id="configure-github-authentication-client-using-the-grafana-configuration-file">Configure GitHub authentication client using the Grafana configuration file</h2>
<p>Ensure that you have access to the <a href="../../../configure-grafana/#configuration-file-location">Grafana configuration file</a>.</p>
<h3 id="configure-github-authentication">Configure GitHub authentication</h3>
<p>To configure GitHub authentication with Grafana, follow these steps:</p>
<ol>
<li>
<p>Create an OAuth application in GitHub.</p>
</li>
<li>
<p>Set the callback URL for your GitHub OAuth app to <code>http://&lt;my_grafana_server_name_or_ip&gt;:&lt;grafana_server_port&gt;/login/github</code>.</p>
<p>Ensure that the callback URL is the complete HTTP address that you use to access Grafana via your browser, but with the appended path of <code>/login/github</code>.</p>
<p>For the callback URL to be correct, it might be necessary to set the <code>root_url</code> option in the <code>[server]</code>section of the Grafana configuration file. For example, if you are serving Grafana behind a proxy.</p>
</li>
<li>
<p>Refer to the following table to update field values located in the <code>[auth.github]</code> section of the Grafana configuration file:</p>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>client_id</code>, <code>client_secret</code></td>
          <td>These values must match the client ID and client secret from your GitHub OAuth app.</td>
      </tr>
      <tr>
          <td><code>enabled</code></td>
          <td>Enables GitHub authentication. Set this value to <code>true</code>.</td>
      </tr>
  </tbody>
</table>
<p>Review the list of other GitHub <a href="#configuration-options">configuration options</a> and complete them, as necessary.</p>
</li>
<li>
<p><a href="#configure-role-mapping">Configure role mapping</a>.</p>
</li>
<li>
<p>Optional: 
    <a href="/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/">Configure team synchronization</a>.</p>
</li>
<li>
<p>Restart Grafana.</p>
<p>You should now see a GitHub login button on the login page and be able to log in or sign up with your GitHub accounts.</p>
</li>
</ol>
<h3 id="configure-role-mapping">Configure role mapping</h3>
<p>Unless the <code>skip_org_role_sync</code> option is enabled, the user&rsquo;s role will be set to the role retrieved from GitHub upon user login.</p>
<p>The user&rsquo;s role is retrieved using a <a href="http://jmespath.org/examples.html" target="_blank" rel="noopener noreferrer">JMESPath</a> expression from the <code>role_attribute_path</code> configuration option.
To map the server administrator role, use the <code>allow_assign_grafana_admin</code> configuration option.
Refer to <a href="#configuration-options">configuration options</a> for more information.</p>
<p>If no valid role is found, the user is assigned the role specified by <a href="../../../configure-grafana/#auto_assign_org_role">the <code>auto_assign_org_role</code> option</a>.
You can disable this default role assignment by setting <code>role_attribute_strict = true</code>. This setting denies user access if no role or an invalid role is returned after evaluating the <code>role_attribute_path</code> and the <code>org_mapping</code> expressions.</p>
<p>You can use the <code>org_mapping</code> configuration options to assign the user to organizations and specify their role based on their GitHub team membership. For more information, refer to <a href="#org-roles-mapping-example">Org roles mapping example</a>. If both org role mapping (<code>org_mapping</code>) and the regular role mapping (<code>role_attribute_path</code>) are specified, then the user will get the highest of the two mapped roles.</p>
<p>To ease configuration of a proper JMESPath expression, go to <a href="http://jmespath.org/" target="_blank" rel="noopener noreferrer">JMESPath</a> to test and evaluate expressions with custom payloads.</p>
<h4 id="role-mapping-examples">Role mapping examples</h4>
<p>This section includes examples of JMESPath expressions used for role mapping.</p>
<h5 id="org-roles-mapping-example">Org roles mapping example</h5>
<p>The GitHub integration uses the external users&rsquo; teams in the <code>org_mapping</code> configuration to map organizations and roles based on their GitHub team membership.</p>
<p>In this example, the user has been granted the role of a <code>Viewer</code> in the <code>org_foo</code> organization, and the role of an <code>Editor</code> in the <code>org_bar</code> and <code>org_baz</code> orgs.</p>
<p>The external user is part of the following GitHub teams: <code>@my-github-organization/my-github-team-1</code> and <code>@my-github-organization/my-github-team-2</code>.</p>
<p>Config:</p>
<pre>org_mapping = @my-github-organization/my-github-team-1:org_foo:Viewer @my-github-organization/my-github-team-2:org_bar:Editor *:org_baz:Editor</pre>
<h5 id="map-roles-using-github-user-information">Map roles using GitHub user information</h5>
<p>In this example, the user with login <code>octocat</code> has been granted the <code>Admin</code> role.
All other users are granted the <code>Viewer</code> role.</p>
<pre>role_attribute_path = [login==&#39;octocat&#39;][0] &amp;&amp; &#39;Admin&#39; || &#39;Viewer&#39;</pre>
<h5 id="map-roles-using-github-teams">Map roles using GitHub teams</h5>
<p>In this example, the user from GitHub team <code>my-github-team</code> has been granted the <code>Editor</code> role.
All other users are granted the <code>Viewer</code> role.</p>
<pre>role_attribute_path = contains(groups[*], &#39;@my-github-organization/my-github-team&#39;) &amp;&amp; &#39;Editor&#39; || &#39;Viewer&#39;</pre>
<h5 id="map-roles-using-multiple-github-teams">Map roles using multiple GitHub teams</h5>
<p>In this example, the users from GitHub teams <code>admins</code> and <code>devops</code> have been granted the <code>Admin</code> role,
the users from GitHub teams <code>engineers</code> and <code>managers</code> have been granted the <code>Editor</code> role,
the users from GitHub team <code>qa</code> have been granted the <code>Viewer</code> role and
all other users are granted the <code>None</code> role.</p>
<pre>role_attribute_path = contains(groups[*], &#39;@my-github-organization/admins&#39;) &amp;&amp; &#39;Admin&#39; || contains(groups[*], &#39;@my-github-organization/devops&#39;) &amp;&amp; &#39;Admin&#39; || contains(groups[*], &#39;@my-github-organization/engineers&#39;) &amp;&amp; &#39;Editor&#39; || contains(groups[*], &#39;@my-github-organization/managers&#39;) &amp;&amp; &#39;Editor&#39; || contains(groups[*], &#39;@my-github-organization/qa&#39;) &amp;&amp; &#39;Viewer&#39; || &#39;None&#39;</pre>
<h5 id="map-server-administrator-role">Map server administrator role</h5>
<p>In this example, the user with login <code>octocat</code> has been granted the <code>Admin</code> organization role as well as the Grafana server admin role.
All other users are granted the <code>Viewer</code> role.</p>
<pre>role_attribute_path = [login==&#39;octocat&#39;][0] &amp;&amp; &#39;GrafanaAdmin&#39; || &#39;Viewer&#39;</pre>
<h5 id="map-one-role-to-all-users">Map one role to all users</h5>
<p>In this example, all users will be assigned <code>Viewer</code> role regardless of the user information received from the identity provider.</p>
<pre>role_attribute_path = &#34;&#39;Viewer&#39;&#34;
skip_org_role_sync = false</pre>
<h3 id="example-of-github-configuration-in-grafana">Example of GitHub configuration in Grafana</h3>
<p>This section includes an example of GitHub configuration in the Grafana configuration file.</p>
<pre>[auth.github]
enabled = true
client_id = YOUR_GITHUB_APP_CLIENT_ID
client_secret = YOUR_GITHUB_APP_CLIENT_SECRET
scopes = user:email,read:org
auth_url = https://github.com/login/oauth/authorize
token_url = https://github.com/login/oauth/access_token
api_url = https://api.github.com/user
allow_sign_up = true
auto_login = false
team_ids = 150,300
allowed_organizations = [&#34;My Organization&#34;, &#34;Octocats&#34;]
allowed_domains = mycompany.com mycompany.org
role_attribute_path = [login==&#39;octocat&#39;][0] &amp;&amp; &#39;GrafanaAdmin&#39; || &#39;Viewer&#39;</pre>
<h2 id="configure-team-synchronization">Configure team synchronization</h2>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>Available in 
    <a href="/docs/grafana/latest/introduction/grafana-enterprise/">Grafana Enterprise</a> and to customers on select Grafana Cloud plans. For pricing information, visit <a href="/pricing/">pricing</a> or contact our sales team.</p></blockquote></div>

<p>By using Team Sync, you can map teams from your GitHub organization to teams within Grafana. This will automatically assign users to the appropriate teams.
Teams for each user are synchronized when the user logs in.</p>
<p>GitHub teams can be referenced in two ways:</p>
<ul>
<li><code>https://github.com/orgs/&lt;org&gt;/teams/&lt;slug&gt;</code></li>
<li><code>@&lt;org&gt;/&lt;slug&gt;</code></li>
</ul>
<p>Examples: <code>https://github.com/orgs/grafana/teams/developers</code> or <code>@grafana/developers</code>.</p>
<p>To learn more about Team Sync, refer to 
    <a href="/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/">Configure team sync</a>.</p>
<h2 id="configuration-options">Configuration options</h2>
<p>The table below describes all GitHub OAuth configuration options. You can apply these options as environment variables, similar to any other configuration within Grafana. For more information, refer to <a href="../../../configure-grafana/#override-configuration-with-environment-variables">Override configuration with environment variables</a>.</p>


<div class="admonition admonition-note"><blockquote><p class="title text-uppercase">Note</p><p>If the configuration option requires a JMESPath expression that includes a colon, enclose the entire expression in quotes to prevent parsing errors. For example <code>role_attribute_path: &quot;role:view&quot;</code></p></blockquote></div>

<table>
  <thead>
      <tr>
          <th>Setting</th>
          <th>Required</th>
          <th>Supported on Cloud</th>
          <th>Description</th>
          <th>Default</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>enabled</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Whether GitHub OAuth authentication is allowed.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>name</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Name used to refer to the GitHub authentication in the Grafana user interface.</td>
          <td><code>GitHub</code></td>
      </tr>
      <tr>
          <td><code>icon</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Icon used for GitHub authentication in the Grafana user interface.</td>
          <td><code>github</code></td>
      </tr>
      <tr>
          <td><code>client_id</code></td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Client ID provided by your GitHub OAuth app.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>client_secret</code></td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Client secret provided by your GitHub OAuth app.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>auth_url</code></td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Authorization endpoint of your GitHub OAuth provider.</td>
          <td><code>https://github.com/login/oauth/authorize</code></td>
      </tr>
      <tr>
          <td><code>token_url</code></td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Endpoint used to obtain GitHub OAuth access token.</td>
          <td><code>https://github.com/login/oauth/access_token</code></td>
      </tr>
      <tr>
          <td><code>api_url</code></td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Endpoint used to obtain GitHub user information compatible with <a href="https://connect2id.com/products/server/docs/api/userinfo" target="_blank" rel="noopener noreferrer">OpenID UserInfo</a>.</td>
          <td><code>https://api.github.com/user</code></td>
      </tr>
      <tr>
          <td><code>scopes</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>List of comma- or space-separated GitHub OAuth scopes.</td>
          <td><code>user:email,read:org</code></td>
      </tr>
      <tr>
          <td><code>allow_sign_up</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Whether to allow new Grafana user creation through GitHub login. If set to <code>false</code>, then only existing Grafana users can log in with GitHub OAuth.</td>
          <td><code>true</code></td>
      </tr>
      <tr>
          <td><code>auto_login</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Set to <code>true</code> to enable users to bypass the login screen and automatically log in. This setting is ignored if you configure multiple auth providers to use auto-login.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>login_prompt</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Indicates the type of user interaction when the user logs in with GitHub. Available values are <code>login</code>, <code>consent</code> and <code>select_account</code>.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>role_attribute_path</code></td>
          <td>No</td>
          <td>Yes</td>
          <td><a href="http://jmespath.org/examples.html" target="_blank" rel="noopener noreferrer">JMESPath</a> expression to use for Grafana role lookup. Grafana will first evaluate the expression using the user information obtained from the UserInfo endpoint. If no role is found, Grafana creates a JSON data with <code>groups</code> key that maps to GitHub teams obtained from GitHub&rsquo;s <a href="https://docs.github.com/en/rest/teams/teams#list-teams-for-the-authenticated-user" target="_blank" rel="noopener noreferrer"><code>/api/user/teams</code></a> endpoint, and evaluates the expression using this data. The result of the evaluation should be a valid Grafana role (<code>None</code>, <code>Viewer</code>, <code>Editor</code>, <code>Admin</code> or <code>GrafanaAdmin</code>). For more information on user role mapping, refer to <a href="#org-roles-mapping-example">Configure role mapping</a>.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>role_attribute_strict</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Set to <code>true</code> to deny user login if the Grafana org role cannot be extracted using <code>role_attribute_path</code> or <code>org_mapping</code>. For more information on user role mapping, refer to <a href="#org-roles-mapping-example">Configure role mapping</a>.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>org_mapping</code></td>
          <td>No</td>
          <td>No</td>
          <td>List of comma- or space-separated <code>&lt;ExternalGitHubTeamName&gt;:&lt;OrgIdOrName&gt;:&lt;Role&gt;</code> mappings. Value can be <code>*</code> meaning &ldquo;All users&rdquo;. Role is optional and can have the following values: <code>None</code>, <code>Viewer</code>, <code>Editor</code> or <code>Admin</code>. For more information on external organization to role mapping, refer to <a href="#org-roles-mapping-example">Org roles mapping example</a>.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>skip_org_role_sync</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Set to <code>true</code> to stop automatically syncing user roles.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>allow_assign_grafana_admin</code></td>
          <td>No</td>
          <td>No</td>
          <td>Set to <code>true</code> to enable automatic sync of the Grafana server administrator role. If this option is set to <code>true</code> and the result of evaluating <code>role_attribute_path</code> for a user is <code>GrafanaAdmin</code>, Grafana grants the user the server administrator privileges and organization administrator role. If this option is set to <code>false</code> and the result of evaluating <code>role_attribute_path</code> for a user is <code>GrafanaAdmin</code>, Grafana grants the user only organization administrator role. For more information on user role mapping, refer to <a href="#configure-role-mapping">Configure role mapping</a>.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>allowed_organizations</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>List of comma- or space-separated organizations. User must be a member of at least one organization to log in.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>allowed_domains</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>List of comma- or space-separated domains. User must belong to at least one domain to log in.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>team_ids</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>Integer list of team IDs. If set, user has to be a member of one of the given teams to log in.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>tls_skip_verify_insecure</code></td>
          <td>No</td>
          <td>No</td>
          <td>If set to <code>true</code>, the client accepts any certificate presented by the server and any host name in that certificate. <em>You should only use this for testing</em>, because this mode leaves SSL/TLS susceptible to man-in-the-middle attacks.</td>
          <td><code>false</code></td>
      </tr>
      <tr>
          <td><code>tls_client_cert</code></td>
          <td>No</td>
          <td>No</td>
          <td>The path to the certificate.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>tls_client_key</code></td>
          <td>No</td>
          <td>No</td>
          <td>The path to the key.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>tls_client_ca</code></td>
          <td>No</td>
          <td>No</td>
          <td>The path to the trusted certificate authority list.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>signout_redirect_url</code></td>
          <td>No</td>
          <td>Yes</td>
          <td>URL to redirect to after the user logs out.</td>
          <td></td>
      </tr>
  </tbody>
</table>
